var GLMAT_EPSILON=1e-6,Matrix=function(){var e={};return e.create=function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.clone=function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.invert=function(e,t){var r=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=t[9],_=t[10],d=t[11],f=t[12],g=t[13],m=t[14],v=t[15],M=r*o-i*a,x=r*h-s*a,p=r*l-n*a,A=i*h-s*o,L=i*l-n*o,R=s*l-n*h,y=u*g-c*f,E=u*m-_*f,G=u*v-d*f,b=c*m-_*g,T=c*v-d*g,F=_*v-d*m,S=M*F-x*T+p*b+A*G-L*E+R*y;return S?(S=1/S,e[0]=(o*F-h*T+l*b)*S,e[1]=(s*T-i*F-n*b)*S,e[2]=(g*R-m*L+v*A)*S,e[3]=(_*L-c*R-d*A)*S,e[4]=(h*G-a*F-l*E)*S,e[5]=(r*F-s*G+n*E)*S,e[6]=(m*p-f*R-v*x)*S,e[7]=(u*R-_*p+d*x)*S,e[8]=(a*T-o*G+l*y)*S,e[9]=(i*G-r*T-n*y)*S,e[10]=(f*L-g*p+v*M)*S,e[11]=(c*p-u*L-d*M)*S,e[12]=(o*E-a*b-h*y)*S,e[13]=(r*b-i*E+s*y)*S,e[14]=(g*x-f*A-m*M)*S,e[15]=(u*A-c*x+_*M)*S,e):null},e.multiply=function(e,t,r){var i=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],c=t[8],_=t[9],d=t[10],f=t[11],g=t[12],m=t[13],v=t[14],M=t[15],x=r[0],p=r[1],A=r[2],L=r[3];return e[0]=x*i+p*o+A*c+L*g,e[1]=x*s+p*h+A*_+L*m,e[2]=x*n+p*l+A*d+L*v,e[3]=x*a+p*u+A*f+L*M,x=r[4],p=r[5],A=r[6],L=r[7],e[4]=x*i+p*o+A*c+L*g,e[5]=x*s+p*h+A*_+L*m,e[6]=x*n+p*l+A*d+L*v,e[7]=x*a+p*u+A*f+L*M,x=r[8],p=r[9],A=r[10],L=r[11],e[8]=x*i+p*o+A*c+L*g,e[9]=x*s+p*h+A*_+L*m,e[10]=x*n+p*l+A*d+L*v,e[11]=x*a+p*u+A*f+L*M,x=r[12],p=r[13],A=r[14],L=r[15],e[12]=x*i+p*o+A*c+L*g,e[13]=x*s+p*h+A*_+L*m,e[14]=x*n+p*l+A*d+L*v,e[15]=x*a+p*u+A*f+L*M,e},e.mul=e.multiply,e.translate=function(e,t,r){var i,s,n,a,o,h,l,u,c,_,d,f,g=r[0],m=r[1],v=r[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*v+t[12],e[13]=t[1]*g+t[5]*m+t[9]*v+t[13],e[14]=t[2]*g+t[6]*m+t[10]*v+t[14],e[15]=t[3]*g+t[7]*m+t[11]*v+t[15]):(i=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],c=t[8],_=t[9],d=t[10],f=t[11],e[0]=i,e[1]=s,e[2]=n,e[3]=a,e[4]=o,e[5]=h,e[6]=l,e[7]=u,e[8]=c,e[9]=_,e[10]=d,e[11]=f,e[12]=i*g+o*m+c*v+t[12],e[13]=s*g+h*m+_*v+t[13],e[14]=n*g+l*m+d*v+t[14],e[15]=a*g+u*m+f*v+t[15]),e},e.scale=function(e,t,r){var i=r[0],s=r[1],n=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.rotate=function(e,t,r,i){var s,n,a,o,h,l,u,c,_,d,f,g,m,v,M,x,p,A,L,R,y,E,G,b,T=i[0],F=i[1],S=i[2],O=Math.sqrt(T*T+F*F+S*S);return Math.abs(O)<GLMAT_EPSILON?null:(O=1/O,T*=O,F*=O,S*=O,s=Math.sin(r),n=Math.cos(r),a=1-n,o=t[0],h=t[1],l=t[2],u=t[3],c=t[4],_=t[5],d=t[6],f=t[7],g=t[8],m=t[9],v=t[10],M=t[11],x=T*T*a+n,p=F*T*a+S*s,A=S*T*a-F*s,L=T*F*a-S*s,R=F*F*a+n,y=S*F*a+T*s,E=T*S*a+F*s,G=F*S*a-T*s,b=S*S*a+n,e[0]=o*x+c*p+g*A,e[1]=h*x+_*p+m*A,e[2]=l*x+d*p+v*A,e[3]=u*x+f*p+M*A,e[4]=o*L+c*R+g*y,e[5]=h*L+_*R+m*y,e[6]=l*L+d*R+v*y,e[7]=u*L+f*R+M*y,e[8]=o*E+c*G+g*b,e[9]=h*E+_*G+m*b,e[10]=l*E+d*G+v*b,e[11]=u*E+f*G+M*b,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},e.rotateX=function(e,t,r){var i=Math.sin(r),s=Math.cos(r),n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],u=t[9],c=t[10],_=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+l*i,e[5]=a*s+u*i,e[6]=o*s+c*i,e[7]=h*s+_*i,e[8]=l*s-n*i,e[9]=u*s-a*i,e[10]=c*s-o*i,e[11]=_*s-h*i,e},e.rotateY=function(e,t,r){var i=Math.sin(r),s=Math.cos(r),n=t[0],a=t[1],o=t[2],h=t[3],l=t[8],u=t[9],c=t[10],_=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-l*i,e[1]=a*s-u*i,e[2]=o*s-c*i,e[3]=h*s-_*i,e[8]=n*i+l*s,e[9]=a*i+u*s,e[10]=o*i+c*s,e[11]=h*i+_*s,e},e.rotateZ=function(e,t,r){var i=Math.sin(r),s=Math.cos(r),n=t[0],a=t[1],o=t[2],h=t[3],l=t[4],u=t[5],c=t[6],_=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+l*i,e[1]=a*s+u*i,e[2]=o*s+c*i,e[3]=h*s+_*i,e[4]=l*s-n*i,e[5]=u*s-a*i,e[6]=c*s-o*i,e[7]=_*s-h*i,e},e.frustum=function(e,t,r,i,s,n,a){var o=1/(r-t),h=1/(s-i),l=1/(n-a);return e[0]=2*n*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*h,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(s+i)*h,e[10]=(a+n)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*n*2*l,e[15]=0,e},e.perspective=function(e,t,r,i,s){var n=1/Math.tan(t/2),a=1/(i-s);return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(s+i)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*s*i*a,e[15]=0,e},e.perspectiveFromFieldOfView=function(e,t,r,i){var s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),h=2/(a+o),l=2/(s+n);return e[0]=h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((a-o)*h*.5),e[9]=(s-n)*l*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},e.ortho=function(e,t,r,i,s,n,a){var o=1/(t-r),h=1/(i-s),l=1/(n-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*o,e[13]=(s+i)*h,e[14]=(a+n)*l,e[15]=1,e},e.lookAt=function(t,r,i,s){var n,a,o,h,l,u,c,_,d,f,g=r[0],m=r[1],v=r[2],M=s[0],x=s[1],p=s[2],A=i[0],L=i[1],R=i[2];return Math.abs(g-A)<GLMAT_EPSILON&&Math.abs(m-L)<GLMAT_EPSILON&&Math.abs(v-R)<GLMAT_EPSILON?e.identity(t):(c=g-A,_=m-L,d=v-R,f=1/Math.sqrt(c*c+_*_+d*d),c*=f,_*=f,d*=f,n=x*d-p*_,a=p*c-M*d,o=M*_-x*c,f=Math.sqrt(n*n+a*a+o*o),f?(f=1/f,n*=f,a*=f,o*=f):(n=0,a=0,o=0),h=_*o-d*a,l=d*n-c*o,u=c*a-_*n,f=Math.sqrt(h*h+l*l+u*u),f?(f=1/f,h*=f,l*=f,u*=f):(h=0,l=0,u=0),t[0]=n,t[1]=h,t[2]=c,t[3]=0,t[4]=a,t[5]=l,t[6]=_,t[7]=0,t[8]=o,t[9]=u,t[10]=d,t[11]=0,t[12]=-(n*g+a*m+o*v),t[13]=-(h*g+l*m+u*v),t[14]=-(c*g+_*m+d*v),t[15]=1,t)},e.str=function(e){return"Matrix("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},e}(),MoGL=function(){var e,t,r,i,s,n,a,o,h,l;return e={factory:1},t={superChain:1},n=0,o=0,a={},r={value:0},i={value:!0,writable:!0},s={value:null,writable:!0},h=function(){r.value=n++,Object.defineProperty(this,"uuid",r),Object.defineProperty(this,"isAlive",i),Object.defineProperty(this,"_id",s),o++},l=h.prototype,Object.defineProperty(l,"id",{get:function(){return this._id},set:function(e){this._id=e}}),Object.defineProperty(l,"destroy",{value:function(){var e;for(e in this)this.hasOwnProperty(e)&&(this[e]=null);this.isAlive=!1,a[this.constructor.uuid]--,o--}}),Object.defineProperty(l,"setId",{value:function(e){return this.id=e,this}}),Object.freeze(l),h.count=function(e){return"function"==typeof e?a[e.uuid]:o},h.error=function(e,t,r){throw new Error(e+"."+t+":"+r)},h.isAlive=function(e){if(!e.isAlive)throw new Error("Destroyed Object:"+e)},h.ext=function(r,i){var s,o,l,u;i===h||"uuid"in i||h.error("MoGL","ext",0),s=function(){var n,o=arguments[0];return o!==t?this instanceof s?(n=o===e?arguments[1]:arguments,i.call(this,t,n),r.apply(this,n),Object.seal(this),a[s.uuid]++,this):s.call(Object.create(s.prototype),e,arguments):(i.apply(this,arguments[1]),void r.apply(this,arguments[1]))},Object.defineProperty(s,"uuid",{value:n++}),s.uuid in a||(a[s.uuid]=0),l=Object.create(i.prototype),o=r.prototype;for(u in o)o.hasOwnProperty(u)&&(l[u]=o[u]);for(u in r)r.hasOwnProperty(u)&&(s[u]=r[u]);return s.prototype=l,Object.freeze(s),Object.seal(l),s},Object.freeze(h),h}(),Vertex={x:"x",y:"y",z:"z",r:"r",g:"g",b:"b",a:"a",normalX:"nx",normalY:"ny",normalZ:"nz",u:"u",v:"v"};Object.freeze(Vertex);var Geometry=function(){var e,t;return e=function(e,t,r){var i,s,n,a,o=e instanceof Float32Array,h=t instanceof Uint16Array;if(console.log(t),Array.isArray(e)||o||MoGL.error("Geometry","constructor",0),Array.isArray(t)||h||MoGL.error("Geometry","constructor",1),r){for(i=r.length,e.length%i&&MoGL.error("Geometry","constructor",2);i--;)r[r[i]]=i;console.log(r)}if(n=arguments[2]?arguments[2].length:3,this._vertexCount=e.length/n,this._triangleCount=t.length/3,this._vertexShaders={},this._position=[],this._normal=[],this._uv=[],this._color=[],this._volume=null,this._key=null,arguments[2]){for(i=0,s=e.length/n;s>i;i++)a=n*i,this._position.push(e[a+r.x],e[a+r.y],e[a+r.z]),r.nx?this._normal.push(e[a+r.nx],e[a+r.ny],e[a+r.nz]):0,r.u?this._uv.push(e[a+r.u],e[a+r.v]):0,r.r?this._color.push(e[a+r.r],e[a+r.g],e[a+r.b],e[a+r.a]):0;this._position=new Float32Array(this._position),this._normal=new Float32Array(this._normal),this._uv=new Float32Array(this._uv),this._color=new Float32Array(this._color)}else this._position=o?e:new Float32Array(e);this._index=h?t:new Uint16Array(t)},t=e.prototype,t.addVertexShader=function(e){return MoGL.isAlive(this),this._vertexShaders[e]=e,this},t.getVertexCount=function(){return MoGL.isAlive(this),this._vertexCount},t.getTriangleCount=function(){return MoGL.isAlive(this),this._triangleCount},t.getVolume=function(){if(MoGL.isAlive(this),!this._volume){for(var e,t,r,i=0,s=0,n=0,a=0,o=0,h=0,l=this._position,u=l.length;u--;)e=3*u,t=e+1,r=e+2,i=l[e]<i?l[e]:i,a=l[e]>a?l[e]:a,s=l[t]<s?l[t]:s,o=l[t]>o?l[t]:o,n=l[r]<n?l[r]:n,h=l[r]>h?l[r]:h;this._volume=[a-i,o-s,h-n]}return this._volume},t.removeVertexShader=function(e){return MoGL.isAlive(this),delete this._vertexShaders[e],this},MoGL.ext(e,MoGL)}(),Material=function(){var e,t,r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,i=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i;return e=function(){this._textures={},this._diffuse={__indexList:[]},this._specular={__indexList:[]},this._diffuseWrap={__indexList:[]},this._normal={__indexList:[]},this._specularNormal={__indexList:[]},this._r=1,this._g=1,this._b=1,this._a=1,this._count=0,this._scene=null,this._key=null,this.setBackgroundColor.apply(this,arguments)},t=e.prototype,t.setBackgroundColor=function(){var e,t,s=arguments[0];1==arguments.length?(s.length>7&&(t=+s.substr(7),s=s.substr(0,7)),"#"==s.charAt(0)&&((e=r.exec(s))?(this._r=parseInt(e[1],16)/255,this._g=parseInt(e[2],16)/255,this._b=parseInt(e[3],16)/255):(e=i.exec(s),this._r=parseInt(e[1]+e[1],16)/255,this._g=parseInt(e[2]+e[2],16)/255,this._b=parseInt(e[3]+e[3],16)/255),this._a=t?t>1?1:t:1)):(this._r=arguments[0],this._g=arguments[1],this._b=arguments[2],this._a=arguments[3]?arguments[3]:1)},t.addTexture=function(e,t){var r=this._scene;r&&!r._textures[t]&&MoGL.error("Material","addTexture",0),this._textures[t]&&MoGL.error("Material","addTexture",1),this._textures[t]={id:t,type:e};var i;return console.log("type :","_"+e),console.log("확인",this["_"+e]),i=arguments[2]?this["_"+e].__indexList.splice(arguments[2],0,{id:t,blendMode:arguments[3]}):this["_"+e].__indexList.push({id:t,blendMode:arguments[3]}),this},t.getRefCount=function(){return this._count},t.removeTexture=function(e){for(var t=this._textures[e].type,r=this["_"+t].__indexList,i=r.length;i--;)if(r[i].id==e){r.splice(i,1);break}return delete this._textures[e],this},MoGL.ext(e,MoGL)}(),Texture={zoomOut:"zoomOut",zoomIn:"zoomIn",crop:"crop",addSpace:"addSpace",diffuse:"diffuse",specular:"specular",diffuseWrap:"diffuseWrap",normal:"normal",specularNormal:"specularNormal"};Object.freeze(Texture);var Mesh=function(){{var e,t,r=new Float32Array(3);Math.sqrt,Math.atan2,Math.asin,Math.cos,.5*Math.PI,180/Math.PI}return e=function(e,t){e&&!("string"==typeof e||e instanceof Geometry)&&MoGL.error("Mesh","contructor",0),t&&!("string"==typeof t||t instanceof Material)&&MoGL.error("Mesh","contructor",1),this._geometry=e,this._material=t,this._scene=null,this._parent=null,this._matrix=Matrix.create(),this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.x=0,this.y=0,this.z=0},t=e.prototype,t.getGeometry=function(){return MoGL.isAlive(this),this._scene?this._geometry:null},t.getMaterial=function(){return MoGL.isAlive(this),this._scene?this._material:null},t.getMatrix=function(){return MoGL.isAlive(this),Matrix.identity(this._matrix),r[0]=this.x,r[1]=this.y,r[2]=this.y,Matrix.translate(this._matrix,this._matrix,r),Matrix.rotateX(this._matrix,this._matrix,this.rotateX),Matrix.rotateY(this._matrix,this._matrix,this.rotateY),Matrix.rotateZ(this._matrix,this._matrix,this.rotateZ),r[0]=this.scaleX,r[1]=this.scaleY,r[2]=this.scaleZ,Matrix.scale(this._matrix,this._matrix,r),this._matrix},t.getParent=function(){return MoGL.isAlive(this),this._parent?this._parent:null},t.getPosition=function(){return MoGL.isAlive(this),r[0]=this.x,r[1]=this.y,r[2]=this.z,r},t.getRotate=function(){return MoGL.isAlive(this),r[0]=this.rotateX,r[1]=this.rotateY,r[2]=this.rotateZ,r},t.getScale=function(){return MoGL.isAlive(this),r[0]=this.scaleX,r[1]=this.scaleY,r[2]=this.scaleZ,r},t.setGeometry=function(e){return MoGL.isAlive(this),e instanceof Geometry||"string"==typeof e||MoGL.error("Mesh","setGeometry",0),this._scene?(this._geometry=(this._geometry="string"==typeof e)?this._scene._geometrys[e]:e,this._geometry._key=this._geometry._key||e):this._geometry=e,this},t.setMaterial=function(e){return MoGL.isAlive(this),e instanceof Material||"string"==typeof e||MoGL.error("Mesh","setMaterial",0),this._scene?(this._material=(this._material="string"==typeof e)?this._scene._materials[e]:e,this._material._key=this._material._key||e):this._material=e,this},t.setPosition=function(){MoGL.isAlive(this);var e=arguments.length,t=arguments[0];return 1==e&&t instanceof Array?(this.x=t[0],this.y=t[1],this.z=t[2]):e>2?(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2]):(this.x=0,this.y=0,this.z=0),this},t.setRotate=function(){MoGL.isAlive(this);var e=arguments.length,t=arguments[0];return 1==e&&t instanceof Array?(this.rotateX=t[0],this.rotateY=t[1],this.rotateZ=t[2]):e>2?(this.rotateX=arguments[0],this.rotateY=arguments[1],this.rotateZ=arguments[2]):(this.rotateX=0,this.rotateY=0,this.rotateZ=0),this},t.setScale=function(){MoGL.isAlive(this);var e=arguments.length,t=arguments[0];return 1==e&&t instanceof Array?(this.scaleX=t[0],this.scaleY=t[1],this.scaleZ=t[2]):e>2?(this.scaleX=arguments[0],this.scaleY=arguments[1],this.scaleZ=arguments[2]):(this.scaleX=1,this.scaleY=1,this.scaleZ=1),this},MoGL.ext(e,MoGL)}(),Group=function(){var e,t;return e=function(){this._children={},this._scene=null},t=e.prototype,t.addChild=function(e,t){MoGL.isAlive(this);var r,i;this._children[e]&&MoGL.error("Group","addChild",0),t instanceof Mesh||MoGL.error("Group","addChild",1),t._scene=this,t.setGeometry(t._geometry),t.setMaterial(t._material),i=t._geometry._vertexShaders;for(r in i)"string"==typeof i[r]&&(this._scene._vertexShaders[i[r]]||MoGL.error("Group","addChild",2));i=t._material._fragmentShaders;for(r in i)"string"==typeof i[r]&&(this._scene._fragmentShaders[i[r]]||MoGL.error("Group","addChild",3));i=t._material._textures;for(r in i)"string"==typeof i[r]&&(this._scene._textures[i[r]]||MoGL.error("Group","addChild",4));return this._children[e]=t,this},t.getChild=function(e){MoGL.isAlive(this);var t=this._children[e];return t?t:null},t.removeChild=function(e){return MoGL.isAlive(this),this._children[e]?(delete this._children[e],!0):!1},MoGL.ext(e,Mesh)}(),Camera=function(){var e,t,r=[],i=Math.PI/180,s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,n=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i;return e=function(){this._cvs=null,this._renderArea=null,this._updateRenderArea=1,this._geometry=new Geometry([],[]),this._material=new Material,this._r=0,this._g=0,this._b=0,this._a=1,this._fov=55,this._near=.1,this._far=1e5,this._visible=1,this._filters={},this._fog=null,this._antialias=!1,this._pixelMatrix=Matrix.create()},t=e.prototype,t.getBackgroundColor=function(){return MoGL.isAlive(this),r[0]=this._r,r[1]=this._g,r[2]=this._b,r[3]=this._a,r},t.getClipPlane=function(){return MoGL.isAlive(this),[this._near,this._far]},t.getFilters=function(){MoGL.isAlive(this);var e=[],t=this._filters;for(var r in t)e.push(r);return e},t.getFog=function(){return MoGL.isAlive(this),this._fog?!0:!1},t.getFOV=function(){return MoGL.isAlive(this),this._fov},t.getProjectionMatrix=function(){return MoGL.isAlive(this),this.setPerspective(),this._pixelMatrix},t.getRenderArea=function(){return MoGL.isAlive(this),this._renderArea},t.getAntialias=function(){return MoGL.isAlive(this),this._antialias?!0:!1},t.getVisible=function(){return MoGL.isAlive(this),this._visible?!0:!1},t.setBackgroundColor=function(){MoGL.isAlive(this);var e,t,r=arguments[0];return 1==arguments.length?(r.length>7&&(t=+r.substr(7),r=r.substr(0,7)),"#"==r.charAt(0)&&((e=s.exec(r))?(this._r=parseInt(e[1],16)/255,this._g=parseInt(e[2],16)/255,this._b=parseInt(e[3],16)/255):(e=n.exec(r),this._r=parseInt(e[1]+e[1],16)/255,this._g=parseInt(e[2]+e[2],16)/255,this._b=parseInt(e[3]+e[3],16)/255),this._a=t?t>1?1:t:1)):(this._r=arguments[0],this._g=arguments[1],this._b=arguments[2],this._a=arguments[3]?arguments[3]:1),this},t.setClipPlane=function(e,t){return MoGL.isAlive(this),this._near=e,this._far=t,this},t.setFilter=function(e){MoGL.isAlive(this);var t;if(arguments[1])t=arguments[1];else switch(e){case Filter.anaglyph:t={offsetL:.008,offsetR:.008,gIntensity:.7,bIntensity:.7};break;case Filter.bevel:t={distance:4,angle:45,highlightColor:"#FFF",highlightAlpha:1,shadowColor:"#000",shadowAlpha:1,blurX:4,blurY:4,strength:1,quality:1,type:"inner",knockout:!1};break;case Filter.bloom:t={threshold:.3,sourceSaturation:1,bloomSaturation:1.3,sourceIntensity:1,bloomIntensity:1};break;case Filter.blur:t={blurX:4,blurY:4,quality:1};break;case Filter.colorMatrix:t={};break;case Filter.convolution:t={matrixX:0,matrixY:0,matrix:null,divisor:1,bias:0,preserveAlpha:!0,clamp:!0,color:0,alpha:0};break;case Filter.displacementMap:t={mapTextureID:null,mapPoint:null,componentX:0,componentY:0,scaleX:0,scaleY:0,mode:"wrap",color:0,alpha:0};break;case Filter.fxaa:t={};break;case Filter.glow:t={color:"#F00",alpha:1,blurX:6,blurY:6,strength:2,quality:1,inner:!1,knockout:!1};break;case Filter.invert:t={};break;case Filter.mono:t={};break;case Filter.sepia:t={};break;case Filter.shadow:t={distance:4,angle:45,color:0,alpha:1,blurX:4,blurY:4,strength:1,quality:1,inner:!1,knockout:!1,hideObject:!1}}return this._filters[e]=t,this},t.setFog=function(e,t,r){MoGL.isAlive(this);var i,a,o=e;return 0!=o&&"#"==o.charAt(0)?(a={},(i=s.exec(o))?(a.r=parseInt(i[1],16)/255,a.g=parseInt(i[2],16)/255,a.b=parseInt(i[3],16)/255):(i=n.exec(o),a.r=parseInt(i[1]+i[1],16)/255,a.g=parseInt(i[2]+i[2],16)/255,a.b=parseInt(i[3]+i[3],16)/255),a.a=1,a.near=t,a.far=r,this._fog=a):o||(this._fog=null),this},t.setFOV=function(){return MoGL.isAlive(this),this._fov=1==arguments.length?arguments[0]:Math.ceil(2*Math.atan(Math.tan(arguments[2]*i/2)*(arguments[1]/arguments[0]))*(180/Math.PI)),this},t.setOrthogonal=function(){return MoGL.isAlive(this),Matrix.identity(this._pixelMatrix),this._pixelMatrix=[2/this._cvs.clientWidth,0,0,0,0,-2/this._cvs.clientHeight,0,0,0,0,0,0,-1,1,0,1],this},t.setPerspective=function(){return MoGL.isAlive(this),Matrix.identity(this._pixelMatrix),Matrix.perspective(this._pixelMatrix,this._fov*Math.PI/180,this._renderArea[2]/this._renderArea[3],this._near,this._far),this},t.setProjectionMatrix=function(e){return MoGL.isAlive(this),this},t.setRenderArea=function(e,t,r,i){MoGL.isAlive(this),this._updateRenderArea=1;var s=this._cvs.clientWidth,n=this._cvs.clientHeight;return console.log("string"==typeof e?s*e.replace("%",""):e),this._renderArea=["string"==typeof e?s*e.replace("%","")*.01:e,"string"==typeof t?n*t.replace("%","")*.01:t,"string"==typeof r?s*r.replace("%","")*.01:r,"string"==typeof i?n*i.replace("%","")*.01:i],this},t.setAntialias=function(e){return MoGL.isAlive(this),this._antialias=e,this},t.setVisible=function(e){return MoGL.isAlive(this),this._visible=e,this},t.removeFilter=function(e){return MoGL.isAlive(this),delete this._filters[e],this},MoGL.ext(e,Mesh)}(),Scene=function(){var e,t;e=function(){this._update=0,this._cvs=null,this._children={},this._cameras={},this._textures={},this._materials={},this._geometrys={},this._vertexShaders={},this._fragmentShaders={},this._gl=null,this._glVBOs={},this._glUVBOs={},this._glIBOs={},this._glPROGRAMs={},this._glTEXTUREs={},this._glFREAMBUFFERs={};var e={attributes:["vec3 aVertexPosition"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition","vec3 uColor"],varyings:["vec3 vColor"],"function":[VertexShader.baseFunction],main:["gl_Position = uPixelMatrix*uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale)*vec4(aVertexPosition, 1.0);\nvColor = uColor ;"]},t={precision:"mediump float",uniforms:[],varyings:["vec3 vColor"],"function":[],main:["gl_FragColor =  vec4(vColor, 1.0)"]},r={attributes:["vec3 aVertexPosition","vec2 aUV"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition"],varyings:["vec2 vUV"],"function":[VertexShader.baseFunction],main:["gl_Position = uPixelMatrix*uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale)*vec4(aVertexPosition, 1.0);\nvUV = aUV;"]},i={precision:"mediump float",uniforms:["sampler2D uSampler"],varyings:["vec2 vUV"],"function":[],main:["gl_FragColor =  texture2D(uSampler, vec2(vUV.s, vUV.t))"]};this.addVertexShader("base",e),this.addFragmentShader("base",t),this.addVertexShader("bitmap",r),this.addFragmentShader("bitmap",i)};var r=function(e,t,r,i){var s=e._gl,n=e._glVBOs[t];return n?n:(n=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,new Float32Array(r),s.STATIC_DRAW),n.name=t,n.type="VBO",n.data=r,n.stride=i,n.numItem=r.length/i,e._glVBOs[t]=n,console.log("VBO생성",e._glVBOs[t]),e._glVBOs[t])},i=function(e,t,r,i){var s=e._gl,n=e._glIBOs[t];return n?n:(n=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),s.STATIC_DRAW),n.name=t,n.type="IBO",n.data=r,n.stride=i,n.numItem=r.length/i,e._glIBOs[t]=n,console.log("IBO생성",e._glIBOs[t]),e._glIBOs[t])},s=function(e,t,r,i){var s=e._gl,n=e._glUVBOs[t];return n?n:(n=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,new Float32Array(r),s.STATIC_DRAW),n.name=t,n.type="UVBO",n.data=r,n.stride=i,n.numItem=r.length/i,e._glUVBOs[t]=n,console.log("UVBO생성",e._glUVBOs[t]),e._glUVBOs[t])},n=function(e,t){var r,i,s,n,h=e._gl;for(r=a(e,e._vertexShaders[t]),i=o(e,e._fragmentShaders[t]),s=h.createProgram(),h.attachShader(s,r),h.attachShader(s,i),h.linkProgram(s),r.name=t+"_vertex",i.name=t+"_fragment",s.name=t,h.getProgramParameter(s,h.LINK_STATUS)||MoGL.error(t," 프로그램 쉐이더 초기화 실패!",0),h.useProgram(s),n=0;n<r.attributes.length;n++)h.bindBuffer(h.ARRAY_BUFFER,e._glVBOs["null"]),h.enableVertexAttribArray(s[r.attributes[n]]=h.getAttribLocation(s,r.attributes[n])),h.vertexAttribPointer(s[r.attributes[n]],e._glVBOs["null"].stride,h.FLOAT,!1,0,0);for(n=0;n<r.uniforms.length;n++)s[r.uniforms[n]]=h.getUniformLocation(s,r.uniforms[n]);return e._glPROGRAMs[t]=s,console.log(r),console.log(i),console.log(s),s},a=function(e,t){var r,i,s,n,a=e._gl,o=a.createShader(a.VERTEX_SHADER);for(o.uniforms=[],o.attributes=[],n="",r=t.attributes,i=r.length,s=0;i>s;s++)n+="attribute "+r[s]+";\n",o.attributes.push(r[s].split(" ")[1]);for(r=t.uniforms,i=r.length,s=0;i>s;s++)n+="uniform "+r[s]+";\n",o.uniforms.push(r[s].split(" ")[1]);for(r=t.varyings,i=r.length,s=0;i>s;s++)n+="varying "+r[s]+";\n";return n+=VertexShader.baseFunction,n+="void main(void){\n",n+=t.main+";\n",n+="}\n",console.log(n),a.shaderSource(o,n),a.compileShader(o),o},o=function(e,t){var r,i,s,n=e._gl,a="",o=n.createShader(n.FRAGMENT_SHADER);for(o.uniforms=[],a+=t.precision?"precision "+t.precision+";\n":"precision mediump float;\n",i=t.uniforms,s=i.length,r=0;s>r;r++)a+="uniform "+i[r]+";\n",o.uniforms.push(i[r].split(" ")[1]);for(i=t.varyings,s=i.length,r=0;s>r;r++)a+="varying "+i[r]+";\n";return a+="void main(void){\n",a+=t.main+";\n",a+="}\n",n.shaderSource(o,a),n.compileShader(o),o.uniforms=t.uniforms,o},h=function(e,t,r){var i=e._gl,s=e._glTEXTUREs[t];return s?s:(s=i.createTexture(),s.img=new Image,console.log(typeof r,r),r instanceof ImageData?s.img.src=r.data:r instanceof HTMLCanvasElement?s.img.src=r.toDataURL():r instanceof HTMLImageElement?s.img.src=r.src:r.substring&&"data:image"==r.substring(0,10)&&r.indexOf("base64")>-1?s.img.src=r:"string"==typeof r&&(s.img.src=r),s.img.onload=function(){i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,s.img),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null),s.loaded=1},s.data=r,e._glTEXTUREs[t]=s,s)},l=function(e,t){var r=e._gl,i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),i.x=t._renderArea[0],i.y=t._renderArea[1],i.width=t._renderArea[2],i.height=t._renderArea[3];var s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i.width,i.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var n=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,i.width,i.height),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,n),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),e._glFREAMBUFFERs[t.uuid]={frameBuffer:i,texture:s}};return t=e.prototype,t.update=function(){MoGL.isAlive(this),this._glVBOs["null"]=r(this,"null",new Float32Array([0,0,0]),3);for(var e in this._children){var t,a=this._children[e],o=a._geometry;o&&(console.log("!!!!!!!!!!!!!!!!!!",o._key),this._geometrys[o._key]||this.addGeometry(o._key,o),this._glVBOs[o]||(t=o._key,this._glVBOs[t]=r(this,t,o._position,3),this._glUVBOs[t]=s(this,t,o._uv,2),this._glIBOs[t]=i(this,t,o._index,1)))}this._glVBOs.rect||(this.addGeometry("rect",new Geometry([1,1,0,0,0,-1,1,0,1,0,1,-1,0,0,1,-1,-1,0,1,1],[0,1,2,1,2,3],[Vertex.x,Vertex.y,Vertex.z,Vertex.u,Vertex.v])),this._glVBOs.rect=r(this,"rect",[1,1,0,-1,1,0,1,-1,0,-1,-1,0],3),this._glUVBOs.rect=s(this,"rect",[0,0,1,0,0,1,1,1],2),this._glIBOs.rect=i(this,"rect",[0,1,2,1,2,3],1));for(e in this._cameras){var h=this._cameras[e];h._cvs=this._cvs,h._renderArea||h.setRenderArea(0,0,this._cvs.clientWidth,this._cvs.clientHeight),h._updateRenderArea&&(h.getProjectionMatrix(),l(this,h),h._updateRenderArea=0)}var u=this._vertexShaders;for(e in u)n(this,e);console.log("////////////////////////////////////////////"),console.log("Scene 업데이트"),console.log("this._glVBOs :",this._glVBOs),console.log("this._glIBOs :",this._glIBOs),console.log("this._glPROGRAMs :",this._glPROGRAMs),console.log("this._geometrys :",this._geometrys),console.log("this._materials :",this._materials),console.log("this._textures :",this._textures),console.log("this._vertexShaders :",this._vertexShaders),console.log("this._fragmentShaders :",this._fragmentShaders),console.log("this._glFREAMBUFFERs :",this._glFREAMBUFFERs),console.log("////////////////////////////////////////////"),this._update=0},t.addChild=function(e,t){MoGL.isAlive(this);var r,i;this._children[e]&&MoGL.error("Scene","addChild",0),t instanceof Mesh||MoGL.error("Scene","addChild",1),t._scene=this,t._parent=this,t.setGeometry(t._geometry),t.setMaterial(t._material),t._material._count++,i=t._geometry._vertexShaders;for(r in i)"string"==typeof i[r]&&(this._vertexShaders[i[r]]||MoGL.error("Scene","addChild",2));i=t._material._fragmentShaders;for(r in i)"string"==typeof i[r]&&(this._fragmentShaders[i[r]]||MoGL.error("Scene","addChild",3));i=t._material._textures;for(r in i)"string"==typeof i[r]&&(this._textures[i[r]]?(console.log(t._material._textures),console.log(i[r]),t._material._textures[i[r]]=this._textures[i[r]]):MoGL.error("Scene","addChild",4));return t instanceof Camera?(this._cameras[e]=t,t._cvs=this._cvs):this._children[e]=t,this._update=1,this},t.addGeometry=function(e,t){MoGL.isAlive(this),this._geometrys[e]&&MoGL.error("Scene","addGeometry",0),t instanceof Geometry||MoGL.error("Scene","addGeometry",1);var r,i=t._vertexShaders;for(r in i)"string"==typeof i[r]&&(this._vertexShaders[i[r]]||MoGL.error("Scene","addGeometry",2));return this._geometrys[e]=t,this},t.addMaterial=function(e,t){MoGL.isAlive(this),this._materials[e]&&MoGL.error("Scene","addMaterial",0),t instanceof Material||MoGL.error("Scene","addMaterial",1);var r,i=t._fragmentShaders;for(r in i)"string"==typeof i[r]&&(this._fragmentShaders[i[r]]||MoGL.error("Scene","addMaterial",2));i=t._textures;for(r in i)"string"==typeof i[r]&&(this._textures[i[r]]||MoGL.error("Scene","addMaterial",3));return this._materials[e]=t,this._materials[e]._scene=this,this},t.addTexture=function(e,t){function r(e){return e instanceof HTMLImageElement?0:e instanceof HTMLCanvasElement?0:e instanceof HTMLVideoElement?0:e instanceof ImageData?0:e.substring&&"data:image"==e.substring(0,10)&&e.indexOf("base64")>-1?0:"string"==typeof e?0:1}return MoGL.isAlive(this),this._textures[e]&&MoGL.error("Scene","addTexture",0),r(t)&&MoGL.error("Scene","addTexture",1),this._textures[e]?this._textures[e].img=h(this,e,t):(this._textures[e]={count:0,last:0,img:null,resizeType:arguments[2]||null},this._textures[e].img=h(this,e,t),console.log(this._textures),console.log(e,t)),this},t.addFragmentShader=function(e,t){return MoGL.isAlive(this),this._fragmentShaders[e]&&MoGL.error("Scene","addFragmentShader",0),this._fragmentShaders[e]=t,this},t.addVertexShader=function(e,t){return MoGL.isAlive(this),this._vertexShaders[e]&&MoGL.error("Scene","addVertexShader",0),this._vertexShaders[e]=t,this},t.getChild=function(e){MoGL.isAlive(this);var t=this._children[e];return t=t?t:this._cameras[e],t?t:null},t.getGeometry=function(e){MoGL.isAlive(this);var t=this._geometrys[e];return t?t:null},t.getMaterial=function(e){MoGL.isAlive(this);var t=this._materials[e];return t?t:null},t.getTexture=function(e){MoGL.isAlive(this);var t=this._textures[e];return t?t:null},t.getFragmentShader=function(e){return MoGL.isAlive(this),this._fragmentShaders[e]},t.getVertexShader=function(e){return MoGL.isAlive(this),this._vertexShaders[e]},t.removeChild=function(e){return MoGL.isAlive(this),this._children[e]?(this._children[e]._material._count--,this._children[e]._scene=null,this._children[e]._parent=null,delete this._children[e],!0):!1},t.removeGeometry=function(e){return MoGL.isAlive(this),this._geometrys[e]?(delete this._geometrys[e],!0):!1},t.removeMaterial=function(e){return MoGL.isAlive(this),this._materials[e]?(delete this._materials[e],!0):!1},t.removeTexture=function(e){return MoGL.isAlive(this),this._textures[e]?(delete this._textures[e],!0):!1},t.removeFragmentShader=function(){return MoGL.isAlive(this),this},t.removeVertexShader=function(){return MoGL.isAlive(this),this},MoGL.ext(e,MoGL)}(),World=function(){var e,t,r=Matrix.create(),i=new Float32Array(3);return e=function(e){e||MoGL.error("World","constructor",0),this._cvs=document.getElementById(e),this._cvs||MoGL.error("World","constructor",1),this._renderList=[],this._sceneList={},this.LOOP={};for(var t="experimental-webgl,webgl,webkit-3d,moz-webgl,3d".split(","),r=t.length;r--&&!(this._gl=this._cvs.getContext(t[r],{antialias:1})););console.log(this._gl?e+" : MoGL 초기화 성공!":console.log(e+" : MoGL 초기화 실패!!"))},t=e.prototype,
t.render=function(){MoGL.isAlive(this);var e,t,s,n,a,o,h,l,u,c,_,d,f,g,m,v,M,x,p,A=this._renderList;for(t in this.LOOP)this.LOOP[t]();for(e=0,s=A.length;s>e;e++)if(A[e].scene._update&&A[e].scene.update(),n=A[e].scene,a=n.getChild(A[e].cameraID),a._visible){o=n._gl,g=n._glFREAMBUFFERs[a.uuid].frameBuffer,o.bindFramebuffer(o.FRAMEBUFFER,g),h=n._children,o.viewport(0,0,g.width,g.height),o.clearColor(a._r,a._g,a._b,a._a),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.enable(o.DEPTH_TEST),o.depthFunc(o.LESS);for(t in n._glPROGRAMs)c=n._glPROGRAMs[t],o.useProgram(c),o.uniformMatrix4fv(c.uPixelMatrix,!1,a._pixelMatrix),o.uniformMatrix4fv(c.uCameraMatrix,!1,a.getMatrix());l=u=c=_=f=null;for(t in h){if(l=h[t],_=n._glVBOs[l._geometry._key],d=n._glUVBOs[l._geometry._key],f=n._glIBOs[l._geometry._key],u=l._material,m=u._diffuse,c=m.__indexList.length>0?n._glPROGRAMs.bitmap:n._glPROGRAMs.base,o.useProgram(c),c==n._glPROGRAMs.base)_!=v?o.bindBuffer(o.ARRAY_BUFFER,_):0,_!=v?o.vertexAttribPointer(c.aVertexPosition,_.stride,o.FLOAT,!1,0,0):0,o.uniform3fv(c.uRotate,[l.rotateX,l.rotateY,l.rotateZ]),o.uniform3fv(c.uPosition,[l.x,l.y,l.z]),o.uniform3fv(c.uScale,[l.scaleX,l.scaleY,l.scaleZ]),o.uniform3fv(c.uColor,[u._r,u._g,u._b]),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,f),o.drawElements(o.TRIANGLES,f.numItem,o.UNSIGNED_SHORT,0);else if(c==n._glPROGRAMs.bitmap){_!=v?o.bindBuffer(o.ARRAY_BUFFER,_):0,_!=v?o.vertexAttribPointer(c.aVertexPosition,_.stride,o.FLOAT,!1,0,0):0,d!=M?o.bindBuffer(o.ARRAY_BUFFER,d):0,d!=M?o.vertexAttribPointer(c.aUV,d.stride,o.FLOAT,!1,0,0):0,o.uniform3fv(c.uRotate,[l.rotateX,l.rotateY,l.rotateZ]),o.uniform3fv(c.uPosition,[l.x,l.y,l.z]),o.uniform3fv(c.uScale,[l.scaleX,l.scaleY,l.scaleZ]),o.activeTexture(o.TEXTURE0);var L=n._glTEXTUREs[m.__indexList[0].id];L.loaded&&(L!=p?o.bindTexture(o.TEXTURE_2D,L):0,o.uniform1i(c.uSampler,0),f!=x?o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,f):0,o.drawElements(o.TRIANGLES,f.numItem,o.UNSIGNED_SHORT,0))}v=_,M=d,x=f,p=L}o.bindFramebuffer(o.FRAMEBUFFER,null)}if(o.viewport(0,0,this._cvs.clientWidth,this._cvs.clientHeight),o.clearColor(0,0,0,1),o.disable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),_=n._glVBOs.rect,d=n._glUVBOs.rect,f=n._glIBOs.rect,c=n._glPROGRAMs.bitmap,_)for(o.useProgram(c),o.uniformMatrix4fv(c.uPixelMatrix,!1,[2/this._cvs.clientWidth,0,0,0,0,-2/this._cvs.clientHeight,0,0,0,0,0,0,-1,1,0,1]),o.bindBuffer(o.ARRAY_BUFFER,_),o.vertexAttribPointer(c.aVertexPosition,_.stride,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,d),o.vertexAttribPointer(c.aUV,d.stride,o.FLOAT,!1,0,0),o.uniform3fv(c.uRotate,[0,0,0]),o.uniformMatrix4fv(c.uCameraMatrix,!1,r),e=0,s=A.length;s>e;e++)n=A[e].scene,a=n.getChild(A[e].cameraID),a._visible&&(g=n._glFREAMBUFFERs[a.uuid].frameBuffer,i[0]=g.x+g.width/2,i[1]=g.y+g.height/2,i[2]=0,o.uniform3fv(c.uPosition,i),i[0]=g.width/2,i[1]=g.height/2,i[2]=1,o.uniform3fv(c.uScale,i),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,n._glFREAMBUFFERs[a.uuid].texture),o.uniform1i(c.uSampler,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,f),o.drawElements(o.TRIANGLES,f.numItem,o.UNSIGNED_SHORT,0))},t.addRender=function(e,t,r){MoGL.isAlive(this);for(var i=e+"_"+t,s=this._sceneList[e],n=this._renderList,a=0,o=n.length;o>a;a++)n[a].uuid==i&&MoGL.error("World","addRender",0);s?s.isAlive||MoGL.error("World","addRender",1):MoGL.error("World","addRender",1),s&&(s.getChild(t)?s.getChild(t).isAlive||MoGL.error("World","addRender",2):MoGL.error("World","addRender",2));var h={uuid:i,sceneID:e,cameraID:t,scene:s,camera:s.getChild(t)};return s._update=1,r?n[r]=h:n.push(h),this},t.addScene=function(e,t){return MoGL.isAlive(this),this._sceneList[e]&&MoGL.error("World","addScene",0),t instanceof Scene||MoGL.error("World","addScene",1),this._sceneList[e]=t,t._gl=this._gl,t._cvs=this._cvs,this},t.getScene=function(e){return MoGL.isAlive(this),this._sceneList[e]?this._sceneList[e]:null},t.removeRender=function(e,t){MoGL.isAlive(this);var r,i,s=this._renderList,n=0,a=0;for(this._sceneList[e]||MoGL.error("World","removeRender",0),this._sceneList[e]._cameras[t]||(console.log("2222222222222222222222222"),MoGL.error("World","removeRender",1)),r=0,i=s.length;i>r;r++)s[r].uuid.indexOf(e)>-1&&(n=1),s[r].uuid.indexOf(t)>-1&&(a=1);for(n||MoGL.error("World","removeRender",2),a||MoGL.error("World","removeRender",3),r=0,i=s.length;i>r;r++)s[r]&&s[r].uuid==e+"_"+t&&s.splice(r,1);return this},t.removeScene=function(e){return MoGL.isAlive(this),this._sceneList[e]?0:MoGL.error("World","removeScene",0),this._sceneList[e]._gl=this._gl,delete this._sceneList[e],this},MoGL.ext(e,MoGL)}(),BlendMode={add:"add",alpha:"alpha",darken:"darken",difference:"difference",erase:"erase",hardlight:"hardlight",invert:"invert",lighten:"lighten",multiply:"multiply",screen:"screen",subtract:"subtract"};Object.freeze(BlendMode);var Filter={anaglyph:"anaglyph",bevel:"bevel",bloom:"bloom",blur:"blur",colorMatrix:"colorMatrix",convolution:"convolution",displacementMap:"displacementMap",fxaa:"fxaa",glow:"glow",invert:"invert",mono:"mono",sepia:"sepia",shadow:"shadow"};Object.freeze(Filter);var Light=function(){var e,t;return e=function(){},t=e.prototype,MoGL.ext(e,Mesh)}(),Primitive=function(){{var e=Math.sin,t=Math.cos,r=Math.PI;Math.sqrt}return{cube:function(){var e;return e},geodesic:function(){var e;return e},line:function(e,t,r,i,s,n){var a;return a},plane:function(){var e,t;e=[1,1,0,0,0,-1,1,0,1,0,1,-1,0,0,1,-1,-1,0,1,1],t=[0,1,2,1,2,3];var r=new Geometry(e,t,[Vertex.x,Vertex.y,Vertex.z,Vertex.u,Vertex.v]);return r._key="plane_"+(arguments[0]||1)+"_"+(arguments[1]||1),r},point:function(){var e;return e},sphere:function(){arguments[0]<8&&(arguments[0]=8);var i,s,n,a,o,h,l,u=[],c=[],_=arguments[0]||8,d=.5;for(a=0;_>=a;a++){i=a*r/_,s=e(i),n=t(i);for(var f=0;_>=f;f++){var g=2*f*r/_,m=e(g),v=t(g),M=v*s,x=n,p=m*s,A=1-f/_,L=1-a/_;u.push(d*M,d*x,-d*p),u.push(A,L)}}for(a=0;_>a;a++)for(o=0;_>o;o++)h=a*(_+1)+o,l=h+_+1,c.push(h,l,h+1,l,l+1,h+1);var R=new Geometry(u,c,[Vertex.x,Vertex.y,Vertex.z,Vertex.u,Vertex.v]);return R._key="sphere_"+(arguments[0]||1),R},skybox:function(){var e;return e}}}(),VertexShader={baseFunction:"mat4 positionMTX(vec3 t){\n   return mat4( 1,0,0,0, 0,1,0,0, 0,0,1,0, t[0],t[1],t[2],1);\n}\nmat4 scaleMTX(vec3 t){\n   return mat4( t[0],0,0,0, 0,t[1],0,0, 0,0,t[2],0, 0,0,0,1);\n}\nmat4 rotationMTX(vec3 t){\n   float s = sin(t[0]);float c = cos(t[0]);\n   mat4 m1 = mat4( 1,0,0,0, 0,c,-s,0, 0,s,c,0, 0,0,0,1);s = sin(t[1]);c = cos(t[1]);\n   mat4 m2 = mat4(c,0,s,0, 0,1,0,0, -s,0,c,0, 0,0,0,1);s = sin(t[2]);c = cos(t[2]);\n   mat4 m3 = mat4(c,-s,0,0, s,c,0,0, 0,0,1,0, 0,0,0,1);\n   return m3*m2*m1;\n}\n"};Object.freeze(VertexShader);