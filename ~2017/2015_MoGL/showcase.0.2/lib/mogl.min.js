!function(e){var t=function(){var e,t,r,i,n,s,a,o,l,h;return e={factory:1},t={superChain:1},s=0,o=0,a={},r={value:0},i={value:!0,writable:!0},n={value:null,writable:!0},l=function(){r.value=s++,Object.defineProperty(this,"uuid",r),Object.defineProperty(this,"isAlive",i),Object.defineProperty(this,"_id",n),o++},h=l.prototype,Object.defineProperty(h,"id",{get:function(){return this._id},set:function(e){this._id=e}}),Object.defineProperty(h,"destroy",{value:function(){var e;for(e in this)this.hasOwnProperty(e)&&(this[e]=null);this.isAlive=!1,a[this.constructor.uuid]--,o--}}),Object.defineProperty(h,"setId",{value:function(e){return this.id=e,this}}),Object.freeze(h),l.count=function(e){return"function"==typeof e?a[e.uuid]:o},l.error=function(e,t,r){throw new Error(e+"."+t+":"+r)},l.isAlive=function(e){if(!e.isAlive)throw new Error("Destroyed Object:"+e)},l.ext=function(r,i){var n,o,h,u;i===l||"uuid"in i||l.error("MoGL","ext",0),n=function(){var s,o=arguments[0];return o!==t?this instanceof n?(s=o===e?arguments[1]:arguments,i.call(this,t,s),r.apply(this,s),Object.seal(this),a[n.uuid]++,this):n.call(Object.create(n.prototype),e,arguments):(i.apply(this,arguments[1]),void r.apply(this,arguments[1]))},Object.defineProperty(n,"uuid",{value:s++}),n.uuid in a||(a[n.uuid]=0),h=Object.create(i.prototype),o=r.prototype;for(u in o)o.hasOwnProperty(u)&&(h[u]=o[u]);for(u in r)r.hasOwnProperty(u)&&(n[u]=r[u]);return n.prototype=h,Object.freeze(n),Object.seal(h),n},l}(),r={add:"add",alpha:"alpha",darken:"darken",difference:"difference",erase:"erase",hardlight:"hardlight",invert:"invert",lighten:"lighten",multiply:"multiply",screen:"screen",subtract:"subtract"};Object.freeze(r);var i={anaglyph:"anaglyph",bevel:"bevel",bloom:"bloom",blur:"blur",colorMatrix:"colorMatrix",convolution:"convolution",displacementMap:"displacementMap",fxaa:"fxaa",glow:"glow",invert:"invert",mono:"mono",sepia:"sepia",shadow:"shadow"};Object.freeze(i);var n={x:"x",y:"y",z:"z",r:"r",g:"g",b:"b",a:"a",normalX:"nx",normalY:"ny",normalZ:"nz",u:"u",v:"v"};Object.freeze(n);var s={none:function(){this._shading.type="none"},gouraud:function(){this._shading.type="gouraud"},phong:function(){this._shading.type="phong"},blinn:function(){this._shading.type="blinn"},flat:function(){this._shading.type="flat"},toon:function(){this._shading.type="toon"}};Object.freeze(s);var a={baseFunction:"mat4 positionMTX(vec3 t){\n   return mat4( 1,0,0,0, 0,1,0,0, 0,0,1,0, t[0],t[1],t[2],1);\n}\nmat4 scaleMTX(vec3 t){\n   return mat4( t[0],0,0,0, 0,t[1],0,0, 0,0,t[2],0, 0,0,0,1);\n}\nmat4 rotationMTX(vec3 t){\n   float s = sin(t[0]);float c = cos(t[0]);\n   mat4 m1 = mat4( 1,0,0,0, 0,c,-s,0, 0,s,c,0, 0,0,0,1);s = sin(t[1]);c = cos(t[1]);\n   mat4 m2 = mat4(c,0,s,0, 0,1,0,0, -s,0,c,0, 0,0,0,1);s = sin(t[2]);c = cos(t[2]);\n   mat4 m3 = mat4(c,-s,0,0, s,c,0,0, 0,0,1,0, 0,0,0,1);\n   return m3*m2*m1;\n}\n"};Object.freeze(a);var o=1e-6,l=function(){var e={};return e.create=function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.clone=function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.invert=function(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],u=t[8],c=t[9],_=t[10],m=t[11],v=t[12],f=t[13],d=t[14],g=t[15],p=r*o-i*a,x=r*l-n*a,A=r*h-s*a,R=i*l-n*o,b=i*h-s*o,y=n*h-s*l,M=u*f-c*v,E=u*d-_*v,T=u*g-m*v,P=c*d-_*f,F=c*g-m*f,S=_*g-m*d,O=p*S-x*F+A*P+R*T-b*E+y*M;return O?(O=1/O,e[0]=(o*S-l*F+h*P)*O,e[1]=(n*F-i*S-s*P)*O,e[2]=(f*y-d*b+g*R)*O,e[3]=(_*b-c*y-m*R)*O,e[4]=(l*T-a*S-h*E)*O,e[5]=(r*S-n*T+s*E)*O,e[6]=(d*A-v*y-g*x)*O,e[7]=(u*y-_*A+m*x)*O,e[8]=(a*F-o*T+h*M)*O,e[9]=(i*T-r*F-s*M)*O,e[10]=(v*b-f*A+g*p)*O,e[11]=(c*A-u*b-m*p)*O,e[12]=(o*E-a*P-l*M)*O,e[13]=(r*P-i*E+n*M)*O,e[14]=(f*x-v*R-d*p)*O,e[15]=(u*R-c*x+_*p)*O,e):null},e.multiply=function(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],_=t[9],m=t[10],v=t[11],f=t[12],d=t[13],g=t[14],p=t[15],x=r[0],A=r[1],R=r[2],b=r[3];return e[0]=x*i+A*o+R*c+b*f,e[1]=x*n+A*l+R*_+b*d,e[2]=x*s+A*h+R*m+b*g,e[3]=x*a+A*u+R*v+b*p,x=r[4],A=r[5],R=r[6],b=r[7],e[4]=x*i+A*o+R*c+b*f,e[5]=x*n+A*l+R*_+b*d,e[6]=x*s+A*h+R*m+b*g,e[7]=x*a+A*u+R*v+b*p,x=r[8],A=r[9],R=r[10],b=r[11],e[8]=x*i+A*o+R*c+b*f,e[9]=x*n+A*l+R*_+b*d,e[10]=x*s+A*h+R*m+b*g,e[11]=x*a+A*u+R*v+b*p,x=r[12],A=r[13],R=r[14],b=r[15],e[12]=x*i+A*o+R*c+b*f,e[13]=x*n+A*l+R*_+b*d,e[14]=x*s+A*h+R*m+b*g,e[15]=x*a+A*u+R*v+b*p,e},e.mul=e.multiply,e.translate=function(e,t,r){var i,n,s,a,o,l,h,u,c,_,m,v,f=r[0],d=r[1],g=r[2];return t===e?(e[12]=t[0]*f+t[4]*d+t[8]*g+t[12],e[13]=t[1]*f+t[5]*d+t[9]*g+t[13],e[14]=t[2]*f+t[6]*d+t[10]*g+t[14],e[15]=t[3]*f+t[7]*d+t[11]*g+t[15]):(i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],_=t[9],m=t[10],v=t[11],e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=h,e[7]=u,e[8]=c,e[9]=_,e[10]=m,e[11]=v,e[12]=i*f+o*d+c*g+t[12],e[13]=n*f+l*d+_*g+t[13],e[14]=s*f+h*d+m*g+t[14],e[15]=a*f+u*d+v*g+t[15]),e},e.scale=function(e,t,r){var i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.rotate=function(e,t,r,i){var n,s,a,l,h,u,c,_,m,v,f,d,g,p,x,A,R,b,y,M,E,T,P,F,S=i[0],O=i[1],C=i[2],B=Math.sqrt(S*S+O*O+C*C);return Math.abs(B)<o?null:(B=1/B,S*=B,O*=B,C*=B,n=Math.sin(r),s=Math.cos(r),a=1-s,l=t[0],h=t[1],u=t[2],c=t[3],_=t[4],m=t[5],v=t[6],f=t[7],d=t[8],g=t[9],p=t[10],x=t[11],A=S*S*a+s,R=O*S*a+C*n,b=C*S*a-O*n,y=S*O*a-C*n,M=O*O*a+s,E=C*O*a+S*n,T=S*C*a+O*n,P=O*C*a-S*n,F=C*C*a+s,e[0]=l*A+_*R+d*b,e[1]=h*A+m*R+g*b,e[2]=u*A+v*R+p*b,e[3]=c*A+f*R+x*b,e[4]=l*y+_*M+d*E,e[5]=h*y+m*M+g*E,e[6]=u*y+v*M+p*E,e[7]=c*y+f*M+x*E,e[8]=l*T+_*P+d*F,e[9]=h*T+m*P+g*F,e[10]=u*T+v*P+p*F,e[11]=c*T+f*P+x*F,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},e.rotateX=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],u=t[9],c=t[10],_=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+h*i,e[5]=a*n+u*i,e[6]=o*n+c*i,e[7]=l*n+_*i,e[8]=h*n-s*i,e[9]=u*n-a*i,e[10]=c*n-o*i,e[11]=_*n-l*i,e},e.rotateY=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],h=t[8],u=t[9],c=t[10],_=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-h*i,e[1]=a*n-u*i,e[2]=o*n-c*i,e[3]=l*n-_*i,e[8]=s*i+h*n,e[9]=a*i+u*n,e[10]=o*i+c*n,e[11]=l*i+_*n,e},e.rotateZ=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],h=t[4],u=t[5],c=t[6],_=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+h*i,e[1]=a*n+u*i,e[2]=o*n+c*i,e[3]=l*n+_*i,e[4]=h*n-s*i,e[5]=u*n-a*i,e[6]=c*n-o*i,e[7]=_*n-l*i,e},e._frustum=function(t,r,i,n,s,a,o){var l=r-t,h=n-i,u=a-s;return o||(o=e.create()),o[0]=2*s/l,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*s/h,o[6]=0,o[7]=0,o[8]=(r+t)/l,o[9]=(n+i)/h,o[10]=-(a+s)/u,o[11]=-1,o[12]=0,o[13]=0,o[14]=-(a*s*2)/u,o[15]=0,o},e.perspective=function(t,r,i,n,s){return t=i*Math.tan(t*Math.PI/360),r=t*r,e._frustum(-r,r,-t,t,i,n,s)},e.lookAt=function(t,r,i,n){var s,a,l,h,u,c,_,m,v,f,d=r[0],g=r[1],p=r[2],x=n[0],A=n[1],R=n[2],b=i[0],y=i[1],M=i[2];return Math.abs(d-b)<o&&Math.abs(g-y)<o&&Math.abs(p-M)<o?e.identity(t):(_=d-b,m=g-y,v=p-M,f=1/Math.sqrt(_*_+m*m+v*v),_*=f,m*=f,v*=f,s=A*v-R*m,a=R*_-x*v,l=x*m-A*_,f=Math.sqrt(s*s+a*a+l*l),f?(f=1/f,s*=f,a*=f,l*=f):(s=0,a=0,l=0),h=m*l-v*a,u=v*s-_*l,c=_*a-m*s,f=Math.sqrt(h*h+u*u+c*c),f?(f=1/f,h*=f,u*=f,c*=f):(h=0,u=0,c=0),t[0]=s,t[1]=h,t[2]=_,t[3]=0,t[4]=a,t[5]=u,t[6]=m,t[7]=0,t[8]=l,t[9]=c,t[10]=v,t[11]=0,t[12]=-(s*d+a*g+l*p),t[13]=-(h*d+u*g+c*p),t[14]=-(_*d+m*g+v*p),t[15]=1,t)},e.str=function(e){return"Matrix("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},e}(),h=function(){var e,r;e=function(e,r,n){var s,a,o,l,h=e instanceof Float32Array,u=r instanceof Uint16Array;if(Array.isArray(e)||h||t.error("Geometry","constructor",0),Array.isArray(r)||u||t.error("Geometry","constructor",1),n)for(s=n.length,e.length%s&&t.error("Geometry","constructor",2);s--;)n[n[s]]=s;if(o=arguments[2]?arguments[2].length:3,this._vertexCount=e.length/o,this._triangleCount=r.length/3,this._vertexShaders={},this._position=[],this._normal=[],this._uv=[],this._color=[],this._volume=null,this._key=null,arguments[2]){for(s=0,a=e.length/o;a>s;s++)l=o*s,this._position.push(e[l+n.x],e[l+n.y],e[l+n.z]),n.nx?this._normal.push(e[l+n.nx],e[l+n.ny],e[l+n.nz]):0,n.u?this._uv.push(e[l+n.u],e[l+n.v]):0,n.r?this._color.push(e[l+n.r],e[l+n.g],e[l+n.b],e[l+n.a]):0;this._position=new Float32Array(this._position),this._uv=new Float32Array(this._uv),this._color=new Float32Array(this._color)}else this._position=h?e:new Float32Array(e);this._index=u?r:new Uint16Array(r),this._normal=new Float32Array(0==this._normal.length?i(this._position,this._index):this._normal)};var i=function(e,t){var r,i,n,s=0,a=1,o=2,l=Math.sqrt,h=[],u=[],c=[],_=[],m=[];for(r=0,n=e.length;n>r;r++)h[r]=0;for(r=0,n=t.length;n>r;r+=3)for(u=[],c=[],_=[],u[s]=e[3*t[r+1]+s]-e[3*t[r]+s],u[a]=e[3*t[r+1]+a]-e[3*t[r]+a],u[o]=e[3*t[r+1]+o]-e[3*t[r]+o],c[s]=e[3*t[r+2]+s]-e[3*t[r+1]+s],c[a]=e[3*t[r+2]+a]-e[3*t[r+1]+a],c[o]=e[3*t[r+2]+o]-e[3*t[r+1]+o],_[s]=u[a]*c[o]-u[o]*c[a],_[a]=u[o]*c[s]-u[s]*c[o],_[o]=u[s]*c[a]-u[a]*c[s],i=0;3>i;i++)h[3*t[r+i]+s]=h[3*t[r+i]+s]+_[s],h[3*t[r+i]+a]=h[3*t[r+i]+a]+_[a],h[3*t[r+i]+o]=h[3*t[r+i]+o]+_[o];for(var t=0,n=e.length;n>t;t+=3){m=[],m[s]=h[t+s],m[a]=h[t+a],m[o]=h[t+o];var n=l(m[s]*m[s]+m[a]*m[a]+m[o]*m[o]);0==n&&(n=1e-5),m[s]=m[s]/n,m[a]=m[a]/n,m[o]=m[o]/n,h[t+s]=m[s],h[t+a]=m[a],h[t+o]=m[o]}return h};return r=e.prototype,r.addVertexShader=function(e){return t.isAlive(this),this._vertexShaders[e]=e,this},r.getVertexCount=function(){return t.isAlive(this),this._vertexCount},r.getTriangleCount=function(){return t.isAlive(this),this._triangleCount},r.getVolume=function(){if(t.isAlive(this),!this._volume){for(var e,r,i,n=0,s=0,a=0,o=0,l=0,h=0,u=this._position,c=u.length;c--;)e=3*c,r=e+1,i=e+2,n=u[e]<n?u[e]:n,o=u[e]>o?u[e]:o,s=u[r]<s?u[r]:s,l=u[r]>l?u[r]:l,a=u[i]<a?u[i]:a,h=u[i]>h?u[i]:h;this._volume=[o-n,l-s,h-a]}return this._volume},r.removeVertexShader=function(e){return t.isAlive(this),delete this._vertexShaders[e],this},t.ext(e,t)}(),u=function(){var e,r,i,n;return i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,n=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i,e=function(){this._textures={},this._shading={type:"none",lambert:1},this._diffuse={__indexList:[]},this._normal={__indexList:[]},this._specular={__indexList:[]},this._diffuseWrap={__indexList:[]},this._specularNormal={__indexList:[]},this._r=1,this._rw=Math.random(),this._g=1,this._gw=Math.random(),this._b=1,this._bw=Math.random(),this._a=1,this._wireFrame=0,this._count=0,this._scene=null,this._key=null,this.setBackgroundColor.apply(this,arguments)},r=e.prototype,r.addTexture=function(e,r){t.isAlive(this);var i=this._scene;i&&!i._textures[r]&&t.error("Material","addTexture",0),this._textures[r]&&t.error("Material","addTexture",1),this._textures[r]={id:r,type:e};var n;if(console.log("type :","_"+e),console.log("확인",this["_"+e],this["_"+e].__indexList.length),void 0!=arguments[2]){var s=arguments[2]>this["_"+e].__indexList.length?this["_"+e].__indexList.length:arguments[2];n=this["_"+e].__indexList.splice(s,0,{id:r,blendMode:arguments[3]})}else n=this["_"+e].__indexList.push({id:r,blendMode:arguments[3]});return this},r.getRefCount=function(){return t.isAlive(this),this._count},r.removeTexture=function(e){t.isAlive(this);var r=this._textures[e];if(!r)return this;for(var i=this._textures[e].type,n=this["_"+i].__indexList,s=n.length;s--;)if(n[s].id==e){n.splice(s,1);break}return delete this._textures[e],console.log("확인",this["_"+i]),this},r.setBackgroundColor=function(){t.isAlive(this);var e,r,s=arguments[0];1==arguments.length?(s.length>7&&(r=+s.substr(7),s=s.substr(0,7)),"#"==s.charAt(0)&&((e=i.exec(s))?(this._r=parseInt(e[1],16)/255,this._g=parseInt(e[2],16)/255,this._b=parseInt(e[3],16)/255):(e=n.exec(s),this._r=parseInt(e[1]+e[1],16)/255,this._g=parseInt(e[2]+e[2],16)/255,this._b=parseInt(e[3]+e[3],16)/255),this._a=r?r>1?1:r:1)):(this._r=arguments[0]?arguments[0]:Math.random(),this._g=arguments[1]?arguments[1]:Math.random(),this._b=arguments[2]?arguments[2]:Math.random(),this._a=arguments[3]?arguments[3]:1)},r.setWireFrame=function(e){t.isAlive(this),this._wireFrame=e;var r,s,a=arguments[1];2==arguments.length&&(a.length>7&&(s=+a.substr(7),a=a.substr(0,7)),(r=i.exec(a))?(this._rw=parseInt(r[1],16)/255,this._gw=parseInt(r[2],16)/255,this._bw=parseInt(r[3],16)/255):(r=n.exec(a),this._rw=parseInt(r[1]+r[1],16)/255,this._gw=parseInt(r[2]+r[2],16)/255,this._bw=parseInt(r[3]+r[3],16)/255))},r.setShading=function(e){t.isAlive(this),e.apply(this)},r.setLambert=function(e){t.isAlive(this),this._shading.lambert=e},t.ext(e,t)}(),c={zoomOut:"zoomOut",zoomIn:"zoomIn",crop:"crop",addSpace:"addSpace",diffuse:"diffuse",specular:"specular",diffuseWrap:"diffuseWrap",normal:"normal",specularNormal:"specularNormal"};Object.freeze(c);var _,m,v=function(){var e=Math.sin,r=Math.cos,i=Math.PI,s=(Math.sqrt,Math.PI/180),a=(180/Math.PI,2*Math.PI),o=Math.PI/2;return{cube:function(){var e;return e},geodesic:function(){var t,l,u,c,_,m,v,f,d,g,p,x,A,R,b,y=1,M=5,E=!0,T=M+1,P=2*T,F=180/P*s,S=[],O=[];for(v=0,f=0,d=-y,E?S.push(v,-d,f,0,0):S.push(v,f,d,0,0),_=0;T>_;_++)for(t=4*(_+1),c=360/t*s,u=-o+(_+1)*F,b=(o+u)/i,g=e(u),p=r(u),d=y*g,m=0;t>=m;m++)l=m*c,x=e(l),A=r(l),v=y*p*A,f=y*p*x,R=l/a,E?S.push(v,-d,f,R,b):S.push(v,f,d,R,b);for(_=1;T>_;_++)for(t=4*(T-_),c=360/t*s,u=F*_,b=(o+u)/i,g=e(u),p=r(u),d=y*g,m=0;t>=m;m++)l=m*c,x=e(l),A=r(l),v=y*p*A,f=y*p*x,R=l/a,E?S.push(v,-d,f,R,b):S.push(v,f,d,R,b);v=0,f=0,d=y,E?S.push(v,-d,f,R,b):S.push(v,f,d,R,b);var C,B,U,L,V,I,D,w,X,N,G,z,Y;for(z=1,V=0,I=0,_=0;T>_;++_){for(w=V,X=I,V+=4*_+1,I+=4*(_+1)+1,N=w,D=V,C=0;4>C;++C)for(G=1,Y=0;z>Y;++Y)1===G?(B=N,L=D,D++,U=D,G=0):(B=D,U=N,N++,L=N,G=1),O.push(B,U,L);z+=2}for(_=T-1;_>=0;_--)for(w=V,X=I,V=V+4*(_+1)+1,I=I+4*_+1,z-=2,D=V,N=w,C=0;4>C;++C)for(G=0,Y=0;z>Y;Y++)1===G?(B=N,L=D,D++,U=D,G=0):(B=D,U=N,N++,L=N,G=1),O.push(B,U,L);var k=new h(S,O,[n.x,n.y,n.z,n.u,n.v]);return k._key="geodesic"+(arguments[0]||1)+"_"+(arguments[1]||1),k},line:function(e,t,r,i,n,s){var a;return a},plane:function(){var e,t;e=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],t=[0,1,2,1,2,3];var r=new h(e,t,[n.x,n.y,n.z]);return r._key="plane_"+(arguments[0]||1)+"_"+(arguments[1]||1),r},point:function(){var e;return e},sphere:function(){for(var t=[],i=[],s=8,a=8,o=1,l=0;s>=l;++l)for(var u=l*Math.PI/s,c=e(u),_=r(u),m=0;a>=m;++m){var v=2*m*Math.PI/a,f=e(v),d=r(v),g=d*c,p=_,x=f*c,A=1-m/a,R=1-l/s;t.push(o*g,o*p,o*x,A,R)}for(l=0;s>l;++l)for(m=0;a>m;++m){var b=l*(a+1)+m,y=b+a+1;i.push(y,b,b+1,y+1,y,b+1)}var M=new h(t,i,[n.x,n.y,n.z,n.u,n.v]);return M._key="sphere_"+(arguments[0]||1),M},skybox:function(){var e;return e},polygon:function(i,s){3>i&&t.error("Primitive","polygon",0);var a,o=2*Math.PI/(i-1),l=[0,0,0,.5,.5],u=[];for(a=0;i>a;a++)l.push(e(o*a),r(o*a),0,-e(o*a)/2+.5,-r(o*a)/2+.5);for(a=0;i-1>a;a++)u.push(0,a+1,a+2);var c=new h(l,u,[n.x,n.y,n.z,n.u,n.v]);return c._key="polygon_"+(arguments[0]||1),c}}}(),f=function(){{var e,r,i,n;Math.sqrt,Math.atan2,Math.asin,Math.cos,.5*Math.PI,180/Math.PI}return i=new Float32Array(3),n=new Float32Array(3),e=function(e,r){e&&!("string"==typeof e||e instanceof h)&&t.error("Mesh","contructor",0),r&&!("string"==typeof r||r instanceof u)&&t.error("Mesh","contructor",1),this._geometry=e,this._material=r,this._scene=null,this._parent=null,this._matrix=l.create(),this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.x=0,this.y=0,this.z=0},r=e.prototype,r.getGeometry=function(){return t.isAlive(this),this._scene?this._geometry:null},r.getMaterial=function(){return t.isAlive(this),this._scene?this._material:null},r.getMatrix=function(){return t.isAlive(this),l.identity(this._matrix),i[0]=this.scaleX,i[1]=this.scaleY,i[2]=this.scaleZ,l.scale(this._matrix,this._matrix,i),l.rotateX(this._matrix,this._matrix,this.rotateX),l.rotateY(this._matrix,this._matrix,this.rotateY),l.rotateZ(this._matrix,this._matrix,this.rotateZ),i[0]=this.x,i[1]=this.y,i[2]=this.z,l.translate(this._matrix,this._matrix,i),this._matrix},r.getParent=function(){return t.isAlive(this),this._parent?this._parent:null},r.getPosition=function(){return t.isAlive(this),i[0]=this.x,i[1]=this.y,i[2]=this.z,i},r.getRotate=function(){return t.isAlive(this),i[0]=this.rotateX,i[1]=this.rotateY,i[2]=this.rotateZ,i},r.getScale=function(){return t.isAlive(this),i[0]=this.scaleX,i[1]=this.scaleY,i[2]=this.scaleZ,i},r.setGeometry=function(e){return t.isAlive(this),e instanceof h||"string"==typeof e||t.error("Mesh","setGeometry",0),this._scene?(this._geometry=(this._geometry="string"==typeof e)?this._scene._geometrys[e]:e,this._geometry._key=this._geometry._key||e):this._geometry=e,this},r.setMaterial=function(e){return t.isAlive(this),e instanceof u||"string"==typeof e||t.error("Mesh","setMaterial",0),this._scene?(this._material=(this._material="string"==typeof e)?this._scene._materials[e]:e,this._material._key=this._material._key||e):this._material=e,this},r.lookAt=function(e,r,s){t.isAlive(this),l.identity(this._matrix),i[0]=this.x,i[1]=this.y,i[2]=this.z,n[0]=e,n[1]=r,n[2]=s,l.lookAt(this._matrix,i,n,[0,1,0]),l.translate(this._matrix,this._matrix,i);var a,o,h,u=this._matrix,c=u[0],_=(u[1],u[2],u[4]),m=u[5],v=u[6],f=u[8],d=u[9],g=u[10],p=-f;o=-1>=p?.5*-Math.PI:p>=1?.5*Math.PI:Math.asin(p);var x=Math.cos(o);.001>=x?(h=0,a=Math.atan2(-v,m)):(h=Math.atan2(_,c),a=Math.atan2(d,g)),this.rotateX=a,this.rotateY=o,this.rotateZ=h},r.setPosition=function(){t.isAlive(this);var e,r;return e=arguments.length,r=arguments[0],1==e&&r instanceof Array?(this.x=r[0],this.y=r[1],this.z=r[2]):e>2?(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2]):(this.x=0,this.y=0,this.z=0),this},r.setRotate=function(){t.isAlive(this);var e,r;return e=arguments.length,r=arguments[0],1==e&&r instanceof Array?(this.rotateX=r[0],this.rotateY=r[1],this.rotateZ=r[2]):e>2?(this.rotateX=arguments[0],this.rotateY=arguments[1],this.rotateZ=arguments[2]):(this.rotateX=0,this.rotateY=0,this.rotateZ=0),this},r.setScale=function(){t.isAlive(this);var e,r;return e=arguments.length,r=arguments[0],1==e&&r instanceof Array?(this.scaleX=r[0],this.scaleY=r[1],this.scaleZ=r[2]):e>2?(this.scaleX=arguments[0],this.scaleY=arguments[1],this.scaleZ=arguments[2]):(this.scaleX=1,this.scaleY=1,this.scaleZ=1),this},t.ext(e,t)}(),d=function(){var e,r;return e=function(){this._children={},this._scene=null},r=e.prototype,r.addChild=function(e,r){t.isAlive(this);var i,n;this._children[e]&&t.error("Group","addChild",0),r instanceof f||t.error("Group","addChild",1),r._scene=this,r.setGeometry(r._geometry),r.setMaterial(r._material),n=r._geometry._vertexShaders;for(i in n)"string"==typeof n[i]&&(this._scene._vertexShaders[n[i]]||t.error("Group","addChild",2));n=r._material._fragmentShaders;for(i in n)"string"==typeof n[i]&&(this._scene._fragmentShaders[n[i]]||t.error("Group","addChild",3));n=r._material._textures;for(i in n)"string"==typeof n[i]&&(this._scene._textures[n[i]]||t.error("Group","addChild",4));return this._children[e]=r,this},r.getChild=function(e){t.isAlive(this);var r=this._children[e];return r?r:null},r.removeChild=function(e){return t.isAlive(this),this._children[e]?(delete this._children[e],!0):!1},t.ext(e,f)}(),g=function(){var e,r,n,s,a,o,c;return n=[],a=Math.PI/180,s=new Float32Array(3),o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,c=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i,e=function(){this._cvs=null,this._renderArea=null,this._updateRenderArea=1,this._geometry=new h([],[]),this._material=new u,this._r=0,this._g=0,this._b=0,this._a=1,this._fov=55,this._near=.1,this._far=1e6,this._visible=1,this._filters={},this._fog=null,this._antialias=!1,this._pixelMatrix=l.create(),this.z=-10,this._mode="3d",this.lookAt(0,0,0)},r=e.prototype,r.getMatrix=function(){return t.isAlive(this),l.identity(this._matrix),l.rotateX(this._matrix,this._matrix,this.rotateX),l.rotateY(this._matrix,this._matrix,this.rotateY),l.rotateZ(this._matrix,this._matrix,this.rotateZ),s[0]=this.x,s[1]=this.y,s[2]=-this.z,l.translate(this._matrix,this._matrix,s),this._matrix},r.getBackgroundColor=function(){return t.isAlive(this),n[0]=this._r,n[1]=this._g,n[2]=this._b,n[3]=this._a,n},r.getClipPlane=function(){return t.isAlive(this),[this._near,this._far]},r.getFilters=function(){t.isAlive(this);var e=[],r=this._filters;for(var i in r)e.push(i);return e},r.getFog=function(){return t.isAlive(this),this._fog?!0:!1},r.getFOV=function(){return t.isAlive(this),this._fov},r.getProjectionMatrix=function(){return t.isAlive(this),l.identity(this._pixelMatrix),"2d"==this._mode?this._pixelMatrix=[2/this._renderArea[2],0,0,0,0,-2/this._renderArea[3],0,0,0,0,0,0,-1,1,0,1]:l.perspective(this._fov,this._renderArea[2]/this._renderArea[3],this._near,this._far,this._pixelMatrix),this._pixelMatrix},r.getRenderArea=function(){return t.isAlive(this),this._renderArea},r.getAntialias=function(){return t.isAlive(this),this._antialias?!0:!1},r.getVisible=function(){return t.isAlive(this),this._visible?!0:!1},r.setBackgroundColor=function(){t.isAlive(this);var e,r,i;return e=arguments[0],1==arguments.length?(e.length>7&&(i=+e.substr(7),e=e.substr(0,7)),"#"==e.charAt(0)&&((r=o.exec(e))?(this._r=parseInt(r[1],16)/255,this._g=parseInt(r[2],16)/255,this._b=parseInt(r[3],16)/255):(r=c.exec(e),this._r=parseInt(r[1]+r[1],16)/255,this._g=parseInt(r[2]+r[2],16)/255,this._b=parseInt(r[3]+r[3],16)/255),this._a=i?i>1?1:i:1)):(this._r=arguments[0],this._g=arguments[1],this._b=arguments[2],this._a=arguments[3]?arguments[3]:1),this},r.setClipPlane=function(e,r){return t.isAlive(this),this._near=e,this._far=r,this},r.setFog=function(e,r,i){t.isAlive(this);var n,s,a=e;return 0!=a&&"#"==a.charAt(0)?(s={},(n=o.exec(a))?(s.r=parseInt(n[1],16)/255,s.g=parseInt(n[2],16)/255,s.b=parseInt(n[3],16)/255):(n=c.exec(a),s.r=parseInt(n[1]+n[1],16)/255,s.g=parseInt(n[2]+n[2],16)/255,s.b=parseInt(n[3]+n[3],16)/255),s.a=1,s.near=r,s.far=i,this._fog=s):a||(this._fog=null),this},r.setFOV=function(){return t.isAlive(this),this._fov=1==arguments.length?arguments[0]:Math.ceil(2*Math.atan(Math.tan(arguments[2]*a/2)*(arguments[1]/arguments[0]))*(180/Math.PI)),this},r.setOthogonal=function(){return t.isAlive(this),this._mode="2d",this},r.setPerspective=function(){return t.isAlive(this),this._mode="3d",this},r.setProjectionMatrix=function(e){return t.isAlive(this),this},r.setRenderArea=function(e,r,i,n){t.isAlive(this);var s,a;return this._updateRenderArea=1,s=this._cvs.width,a=this._cvs.height,console.log("string"==typeof e?s*e.replace("%",""):e),this._renderArea=["string"==typeof e?s*e.replace("%","")*.01:e,"string"==typeof r?a*r.replace("%","")*.01:r,"string"==typeof i?s*i.replace("%","")*.01:i,"string"==typeof n?a*n.replace("%","")*.01:n],this},r.setAntialias=function(e){return t.isAlive(this),this._antialias=e,this},r.setVisible=function(e){return t.isAlive(this),this._visible=e,this},r.setFilter=function(e){t.isAlive(this);var r;if(arguments[1])r=arguments[1];else switch(e){case i.anaglyph:r={offsetL:.008,offsetR:.008,gIntensity:.7,bIntensity:.7};break;case i.bevel:r={distance:4,angle:45,highlightColor:"#FFF",highlightAlpha:1,shadowColor:"#000",shadowAlpha:1,blurX:4,blurY:4,strength:1,quality:1,type:"inner",knockout:!1};break;case i.bloom:r={threshold:.3,sourceSaturation:1,bloomSaturation:1.3,sourceIntensity:1,bloomIntensity:1};break;case i.blur:r={blurX:4,blurY:4,quality:1};break;case i.colorMatrix:r={};break;case i.convolution:r={matrixX:0,matrixY:0,matrix:null,divisor:1,bias:0,preserveAlpha:!0,clamp:!0,color:0,alpha:0};break;case i.displacementMap:r={mapTextureID:null,mapPoint:null,componentX:0,componentY:0,scaleX:0,scaleY:0,mode:"wrap",color:0,alpha:0};break;case i.fxaa:r={};break;case i.glow:r={color:"#F00",alpha:1,blurX:6,blurY:6,strength:2,quality:1,inner:!1,knockout:!1};break;case i.invert:r={};break;case i.mono:r={};break;case i.sepia:r={};break;case i.shadow:r={distance:4,angle:45,color:0,alpha:1,blurX:4,blurY:4,strength:1,quality:1,inner:!1,knockout:!1,hideObject:!1}}return this._filters[e]=r,this},r.removeFilter=function(e){return t.isAlive(this),delete this._filters[e],this},t.ext(e,f)}(),p=function(){var e,r;e=function(){this._update=0,this._cvs=null,this._children={},this._cameras={},this._textures={},this._materials={},this._geometrys={},this._vertexShaders={},this._fragmentShaders={},this._gl=null,this._glVBOs={},this._glVNBOs={},this._glUVBOs={},this._glIBOs={},this._glPROGRAMs={},this._glTEXTUREs={},this._glFREAMBUFFERs={};var e={attributes:["vec3 aVertexPosition"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition","vec3 uColor"],varyings:["vec3 vColor"],"function":[a.baseFunction],main:["gl_Position = uPixelMatrix*uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale)*vec4(aVertexPosition, 1.0);\nvColor = uColor ;gl_PointSize = 10.0;"]},t={precision:"mediump float",uniforms:[],varyings:["vec3 vColor"],"function":[],main:["gl_FragColor =  vec4(vColor, 1.0)"]},r={attributes:["vec3 aVertexPosition","vec2 aUV"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition"],varyings:["vec2 vUV"],"function":[a.baseFunction],main:["gl_Position = uPixelMatrix*uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale)*vec4(aVertexPosition, 1.0);\nvUV = aUV;"]},i={precision:"mediump float",uniforms:["sampler2D uSampler"],varyings:["vec2 vUV"],"function":[],main:["gl_FragColor =  texture2D(uSampler, vec2(vUV.s, vUV.t))"]},n={attributes:["vec3 aVertexPosition","vec2 aUV","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uDLite","float uLambert","vec3 uRotate","vec3 uScale","vec3 uPosition"],varyings:["vec2 vUV","vec4 vLight"],"function":[a.baseFunction],main:[" mat4 mv = positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\n gl_Position = uPixelMatrix*uCameraMatrix*mv*vec4(aVertexPosition, 1.0);\n vec3 LD = normalize(uDLite);\n vec3 N = normalize(vec3(mv * vec4(aVertexNormal, 0.0) ));\n vLight = vec4 (vec3(clamp(dot(N,-LD)*uLambert,0.05,1.0)),1.0);\n vUV = aUV;"]},s={precision:"mediump float",uniforms:["sampler2D uSampler"],varyings:["vec2 vUV","vec4 vLight"],"function":[],main:["gl_FragColor =  (vLight*texture2D(uSampler, vec2(vUV.s, vUV.t)));\ngl_FragColor.a = 1.0;"]},o={attributes:["vec3 aVertexPosition","vec2 aUV","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uDLite","float uLambert","vec3 uRotate","vec3 uScale","vec3 uPosition","vec3 uColor"],varyings:["vec3 vColor","vec4 vLight"],"function":[a.baseFunction],main:[" mat4 mv = positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\n gl_Position = uPixelMatrix*uCameraMatrix*mv*vec4(aVertexPosition, 1.0);\n vec3 LD = normalize(uDLite);\n vec3 N = normalize(vec3(mv * vec4(aVertexNormal, 0.0) ));\n vLight = vec4 (vec3(clamp(dot(N,-LD)*uLambert,0.05,1.0)),1.0);\n vColor = uColor;"]},l={precision:"mediump float",uniforms:["sampler2D uSampler"],varyings:["vec3 vColor","vec4 vLight"],"function":[],main:["gl_FragColor =  vLight*vec4(vColor,1.0);\ngl_FragColor.a = 1.0;"]},h={attributes:["vec3 aVertexPosition","vec2 aUV","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition","vec3 uColor"],varyings:["vec3 vNormal","vec3 vPosition","vec3 vColor"],"function":[a.baseFunction],main:["mat4 mv = positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\ngl_Position = uPixelMatrix*uCameraMatrix*mv*vec4(aVertexPosition, 1.0);\nvPosition = vec3(mv * vec4(aVertexPosition, 1.0));\nvNormal = vec3(mv * vec4(aVertexNormal, 0.0));\nvColor = uColor;"]},u={precision:"mediump float",uniforms:["float uLambert","vec3 uDLite"],varyings:["vec3 vNormal","vec3 vPosition","vec3 vColor"],"function":[],main:["vec3 ambientColor = vec3(0.0, 0.0, 0.0);\nvec3 diffuseColor = vec3(1.0, 1.0, 1.0);\nvec3 specColor = vec3(1.0, 1.0, 1.0);\nvec3 normal = normalize(vNormal);\nvec3 lightDir = normalize(-uDLite);\nvec3 reflectDir = reflect(lightDir, normal);\nvec3 viewDir = normalize(-vPosition);\nfloat lambertian = max(dot(lightDir,normal), 0.05)*uLambert;\nfloat specular = 0.0;\nif(lambertian > 0.0) {\nfloat specAngle = max(dot(reflectDir, viewDir), 0.0);\n   specular = pow(specAngle, 4.0);\n}\ngl_FragColor = vec4(vColor,1.0)*vec4(ambientColor +lambertian*diffuseColor +specular*specColor, 1.0);\ngl_FragColor.a = 1.0;"]},c={attributes:["vec3 aVertexPosition","vec2 aUV","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition","vec3 uColor"],varyings:["vec3 vNormal","vec3 vPosition","vec3 vColor"],"function":[a.baseFunction],main:["mat4 mv = positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\ngl_Position = uPixelMatrix*uCameraMatrix*mv*vec4(aVertexPosition, 1.0);\nvPosition = vec3(mv * vec4(aVertexPosition, 1.0));\nvNormal = vec3(mv * vec4(aVertexNormal, 0.0));\nvColor = uColor;"]},_={precision:"mediump float",uniforms:["float uLambert","vec3 uDLite"],varyings:["vec3 vNormal","vec3 vPosition","vec3 vColor"],"function":[],main:["vec3 ambientColor = vec3(0.0, 0.0, 0.0);\nvec3 diffuseColor = vec3(1.0, 1.0, 1.0);\nvec3 specColor = vec3(1.0, 1.0, 1.0);\nvec3 normal = normalize(vNormal);\nvec3 lightDir = normalize(-uDLite);\nvec3 reflectDir = reflect(lightDir, normal);\nvec3 viewDir = normalize(-vPosition);\nfloat lambertian = max(dot(lightDir,normal), 0.0)*uLambert;\nfloat specular = 0.0;\nvec3 src = vColor;\n if(lambertian>0.95) src.rgb*=0.95;\n else if(lambertian>0.6) src.rgb*=0.5;\n else if(lambertian>0.3) src.rgb*=0.3;\n else src.rgb*=0.1;\nif(lambertian > 0.0) {\nfloat specAngle = max(dot(reflectDir, viewDir), 0.0);\n   specular = pow(specAngle, 4.0);\n}\ngl_FragColor = vec4(src,1.0)*vec4(ambientColor +lambertian*diffuseColor +specular*specColor, 1.0);\ngl_FragColor.a = 1.0;"]},m={attributes:["vec3 aVertexPosition","vec2 aUV","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition"],varyings:["vec2 vUV","vec3 vNormal","vec3 vPosition"],"function":[a.baseFunction],main:["mat4 mv = positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\ngl_Position = uPixelMatrix*uCameraMatrix*mv*vec4(aVertexPosition, 1.0);\nvPosition = vec3(mv * vec4(aVertexPosition, 1.0));\nvNormal = vec3(mv * vec4(aVertexNormal, 0.0));\nvUV = aUV;"]},v={precision:"mediump float",uniforms:["sampler2D uSampler","float uLambert","vec3 uDLite"],varyings:["vec2 vUV","vec3 vNormal","vec3 vPosition"],"function":[],main:["vec3 ambientColor = vec3(0.0, 0.0, 0.0);\nvec3 diffuseColor = vec3(1.0, 1.0, 1.0);\nvec3 specColor = vec3(1.0, 1.0, 1.0);\nvec3 normal = normalize(vNormal);\nvec3 lightDir = normalize(-uDLite);\nvec3 reflectDir = reflect(lightDir, normal);\nvec3 viewDir = normalize(-vPosition);\nfloat lambertian = max(dot(lightDir,normal), 0.05)*uLambert;\nfloat specular = 0.0;\nif(lambertian > 0.0) {\nfloat specAngle = max(dot(reflectDir, viewDir), 0.0);\n   specular = pow(specAngle, 4.0);\n}\ngl_FragColor = texture2D(uSampler, vec2(vUV.s, vUV.t))*vec4(ambientColor +lambertian*diffuseColor +specular*specColor, 1.0);\ngl_FragColor.a = 1.0;"]
};this.addVertexShader("color",e),this.addFragmentShader("color",t),this.addVertexShader("bitmap",r),this.addFragmentShader("bitmap",i),this.addVertexShader("bitmapGouraud",n),this.addFragmentShader("bitmapGouraud",s),this.addVertexShader("colorGouraud",o),this.addFragmentShader("colorGouraud",l),this.addVertexShader("colorPhong",h),this.addFragmentShader("colorPhong",u),this.addVertexShader("colorToon",c),this.addFragmentShader("colorToon",_),this.addVertexShader("bitmapPhong",m),this.addFragmentShader("bitmapPhong",v)};var i=function(e,t,r,i){var n,s;return n=e._gl,(s=e._glVBOs[t])?s:(s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),s.name=t,s.type="VBO",s.data=r,s.stride=i,s.numItem=r.length/i,e._glVBOs[t]=s,console.log("VBO생성",e._glVBOs[t]),e._glVBOs[t])},n=function(e,t,r,i){var n,s;return n=e._gl,(s=e._glVNBOs[t])?s:(s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),s.name=t,s.type="VNBO",s.data=r,s.stride=i,s.numItem=r.length/i,e._glVNBOs[t]=s,console.log("VNBO생성",e._glVNBOs[t]),e._glVNBOs[t])},s=function(e,t,r,i){var n,s;return n=e._gl,(s=e._glIBOs[t])?s:(s=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),n.STATIC_DRAW),s.name=t,s.type="IBO",s.data=r,s.stride=i,s.numItem=r.length/i,e._glIBOs[t]=s,console.log("IBO생성",e._glIBOs[t]),e._glIBOs[t])},o=function(e,t,r,i){var n,s;return n=e._gl,(s=e._glUVBOs[t])?s:(s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),s.name=t,s.type="UVBO",s.data=r,s.stride=i,s.numItem=r.length/i,e._glUVBOs[t]=s,console.log("UVBO생성",e._glUVBOs[t]),e._glUVBOs[t])},l=function(e,r){var i,n,s,a,o;for(i=e._gl,n=c(e,e._vertexShaders[r]),s=_(e,e._fragmentShaders[r]),a=i.createProgram(),i.attachShader(a,n),i.attachShader(a,s),i.linkProgram(a),n.name=r+"_vertex",s.name=r+"_fragment",a.name=r,i.getProgramParameter(a,i.LINK_STATUS)||t.error(r," 프로그램 쉐이더 초기화 실패!",0),i.useProgram(a),o=0;o<n.attributes.length;o++)i.bindBuffer(i.ARRAY_BUFFER,e._glVBOs["null"]),i.enableVertexAttribArray(a[n.attributes[o]]=i.getAttribLocation(a,n.attributes[o])),i.vertexAttribPointer(a[n.attributes[o]],e._glVBOs["null"].stride,i.FLOAT,!1,0,0);for(o=0;o<n.uniforms.length;o++)a[n.uniforms[o]]=i.getUniformLocation(a,n.uniforms[o]);for(o=0;o<s.uniforms.length;o++)a[s.uniforms[o]]=i.getUniformLocation(a,s.uniforms[o]);return e._glPROGRAMs[r]=a,a},c=function(e,t){var r,i,n,s,o,l;for(r=e._gl,l=r.createShader(r.VERTEX_SHADER),l.uniforms=[],l.attributes=[],o="",i=t.attributes,n=i.length,s=0;n>s;s++)o+="attribute "+i[s]+";\n",l.attributes.push(i[s].split(" ")[1]);for(i=t.uniforms,n=i.length,s=0;n>s;s++)o+="uniform "+i[s]+";\n",l.uniforms.push(i[s].split(" ")[1]);for(i=t.varyings,n=i.length,s=0;n>s;s++)o+="varying "+i[s]+";\n";return o+=a.baseFunction,o+="void main(void){\n",o+=t.main+";\n",o+="}\n",r.shaderSource(l,o),r.compileShader(l),l},_=function(e,t){var r,i,n,s,a,o;for(r=e._gl,i="",o=r.createShader(r.FRAGMENT_SHADER),o.uniforms=[],i+=t.precision?"precision "+t.precision+";\n":"precision mediump float;\n",s=t.uniforms,a=s.length,n=0;a>n;n++)i+="uniform "+s[n]+";\n",o.uniforms.push(s[n].split(" ")[1]);for(s=t.varyings,a=s.length,n=0;a>n;n++)i+="varying "+s[n]+";\n";return i+="void main(void){\n",i+=t.main+";\n",i+="}\n",r.shaderSource(o,i),r.compileShader(o),o},m=function(e,t,r){var i,n;return i=e._gl,(n=e._glTEXTUREs[t])?n:(n=i.createTexture(),n.img=new Image,console.log(typeof r,r),r instanceof ImageData?n.img.src=r.data:r instanceof HTMLCanvasElement?n.img.src=r.toDataURL():r instanceof HTMLImageElement?n.img.src=r.src:r.substring&&"data:image"==r.substring(0,10)&&r.indexOf("base64")>-1?n.img.src=r:"string"==typeof r&&(n.img.src=r),n.img.onload=function(){var e=function(e){return 0==(e&e-1)};i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,n.img),e(n.img.width)&&e(n.img.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.generateMipmap(i.TEXTURE_2D)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)),n.loaded=1},n.data=r,e._glTEXTUREs[t]=n,i.bindTexture(i.TEXTURE_2D,null),n)},v=function(e,t){var r,i,n,s;r=e._gl,i=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,i),i.x=t._renderArea[0],i.y=t._renderArea[1],i.width=t._renderArea[2],i.height=t._renderArea[3],n=r.createTexture(),r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i.width,i.height,0,r.RGBA,r.UNSIGNED_BYTE,null),s=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,s),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,i.width,i.height),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,s),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),e._glFREAMBUFFERs[t.uuid]={frameBuffer:i,texture:n}};return r=e.prototype,r.update=function(){t.isAlive(this);var e,r;this._glVBOs["null"]=i(this,"null",new Float32Array([0,0,0]),3);for(e in this._children){var a,h=this._children[e],u=h._geometry;u&&(this._geometrys[u._key]||this.addGeometry(u._key,u),this._glVBOs[u]||(a=u._key,this._glVBOs[a]=i(this,a,u._position,3),this._glVNBOs[a]=n(this,a,u._normal,3),this._glUVBOs[a]=o(this,a,u._uv,2),this._glIBOs[a]=s(this,a,u._index,1)))}this._glVBOs.rect||(this._glVBOs.rect=i(this,"rect",[-1,-1,0,1,-1,0,1,1,0,-1,1,0],3),this._glUVBOs.rect=o(this,"rect",[0,0,1,0,1,1,0,1],2),this._glIBOs.rect=s(this,"rect",[0,1,2,0,2,3],1));for(e in this._cameras){var c=this._cameras[e];c._cvs=this._cvs,c._renderArea||c.setRenderArea(0,0,this._cvs.width,this._cvs.height),c._updateRenderArea&&(c.getProjectionMatrix(),v(this,c),c._updateRenderArea=0)}r=this._vertexShaders;for(e in r)l(this,e);console.log("////////////////////////////////////////////"),console.log("Scene 업데이트"),console.log("this._glVBOs :",this._glVBOs),console.log("this._glVNBOs :",this._glVNBOs),console.log("this._glIBOs :",this._glIBOs),console.log("this._glPROGRAMs :",this._glPROGRAMs),console.log("this._geometrys :",this._geometrys),console.log("this._materials :",this._materials),console.log("this._textures :",this._textures),console.log("this._vertexShaders :",this._vertexShaders),console.log("this._fragmentShaders :",this._fragmentShaders),console.log("this._glFREAMBUFFERs :",this._glFREAMBUFFERs),console.log("////////////////////////////////////////////"),this._update=0},r.addChild=function(e,r){t.isAlive(this);var i,n;this._children[e]&&t.error("Scene","addChild",0),r instanceof f||t.error("Scene","addChild",1),r._scene=this,r._parent=this,r.setGeometry(r._geometry),r.setMaterial(r._material),r._material._count++,n=r._geometry._vertexShaders;for(i in n)"string"==typeof n[i]&&(this._vertexShaders[n[i]]||t.error("Scene","addChild",2));n=r._material._fragmentShaders;for(i in n)"string"==typeof n[i]&&(this._fragmentShaders[n[i]]||t.error("Scene","addChild",3));n=r._material._textures;for(i in n)"string"==typeof n[i]&&(this._textures[n[i]]?(console.log(r._material._textures),console.log(n[i]),r._material._textures[n[i]]=this._textures[n[i]]):t.error("Scene","addChild",4));return r instanceof g?(this._cameras[e]=r,r._cvs=this._cvs):this._children[e]=r,this._update=1,this},r.addGeometry=function(e,r){t.isAlive(this),this._geometrys[e]&&t.error("Scene","addGeometry",0),r instanceof h||t.error("Scene","addGeometry",1);var i,n=r._vertexShaders;for(i in n)"string"==typeof n[i]&&(this._vertexShaders[n[i]]||t.error("Scene","addGeometry",2));return this._geometrys[e]=r,this},r.addMaterial=function(e,r){t.isAlive(this),this._materials[e]&&t.error("Scene","addMaterial",0),r instanceof u||t.error("Scene","addMaterial",1);var i,n=r._fragmentShaders;for(i in n)"string"==typeof n[i]&&(this._fragmentShaders[n[i]]||t.error("Scene","addMaterial",2));n=r._textures;for(i in n)"string"==typeof n[i]&&(this._textures[n[i]]||t.error("Scene","addMaterial",3));return this._materials[e]=r,this._materials[e]._scene=this,this},r.addTexture=function(e,r){function i(e){return e instanceof HTMLImageElement?0:e instanceof HTMLCanvasElement?0:e instanceof HTMLVideoElement?0:e instanceof ImageData?0:e.substring&&"data:image"==e.substring(0,10)&&e.indexOf("base64")>-1?0:"string"==typeof e?0:1}return t.isAlive(this),this._textures[e]&&t.error("Scene","addTexture",0),i(r)&&t.error("Scene","addTexture",1),this._textures[e]?this._textures[e].img=m(this,e,r):(this._textures[e]={count:0,last:0,img:null,resizeType:arguments[2]||null},this._textures[e].img=m(this,e,r),console.log(this._textures),console.log(e,r)),this},r.addFragmentShader=function(e,r){return t.isAlive(this),this._fragmentShaders[e]&&t.error("Scene","addFragmentShader",0),this._fragmentShaders[e]=r,this},r.addVertexShader=function(e,r){return t.isAlive(this),this._vertexShaders[e]&&t.error("Scene","addVertexShader",0),this._vertexShaders[e]=r,this},r.getChild=function(e){t.isAlive(this);var r=this._children[e];return r=r?r:this._cameras[e],r?r:null},r.getGeometry=function(e){t.isAlive(this);var r=this._geometrys[e];return r?r:null},r.getMaterial=function(e){t.isAlive(this);var r=this._materials[e];return r?r:null},r.getTexture=function(e){t.isAlive(this);var r=this._textures[e];return r?r:null},r.getFragmentShader=function(e){return t.isAlive(this),this._fragmentShaders[e]},r.getVertexShader=function(e){return t.isAlive(this),this._vertexShaders[e]},r.removeChild=function(e){return t.isAlive(this),this._children[e]?(this._children[e]._material._count--,this._children[e]._scene=null,this._children[e]._parent=null,delete this._children[e],!0):!1},r.removeGeometry=function(e){return t.isAlive(this),this._geometrys[e]?(delete this._geometrys[e],!0):!1},r.removeMaterial=function(e){return t.isAlive(this),this._materials[e]?(delete this._materials[e],!0):!1},r.removeTexture=function(e){return t.isAlive(this),this._textures[e]?(delete this._textures[e],!0):!1},r.removeFragmentShader=function(){return t.isAlive(this),this},r.removeVertexShader=function(){return t.isAlive(this),this},t.ext(e,t)}(),x=function(){var e,r,i=l.create(),n=new Float32Array(3);return e=function(e){var r,i,n;e||t.error("World","constructor",0),this._cvs=document.getElementById(e),this._cvs||t.error("World","constructor",1);var s=window.innerWidth,a=window.innerHeight;for(this._pixelRatio=window.devicePixelRatio,this._cvs.width=s*this._pixelRatio,this._cvs.height=a*this._pixelRatio,this._cvs.style.width=s+"px",this._cvs.style.height=a+"px",this._renderList=[],this._sceneList={},this.LOOP={},r="experimental-webgl,webgl,webkit-3d,moz-webgl,3d".split(","),i=r.length;i--&&!(this._gl=this._cvs.getContext(r[i],{antialias:!0})););n=this._gl.getExtension("OES_element_index_uint"),n||alert("no! OES_element_index_uint"),console.log(this._gl?e+" : MoGL 초기화 성공!":console.log(e+" : MoGL 초기화 실패!!"))},r=e.prototype,r.render=function(){t.isAlive(this);var e,r,s,a,o,l,h,u,c,_,m,v,f,d,g,p,x,A,R,b,y,M,E=this._renderList;for(r in this.LOOP)this.LOOP[r]();for(e=0,s=E.length;s>e;e++)if(E[e].scene._update&&E[e].scene.update(),a=E[e].scene,o=a.getChild(E[e].cameraID),o._visible){l=a._gl,s>1?(g=a._glFREAMBUFFERs[o.uuid].frameBuffer,l.bindFramebuffer(l.FRAMEBUFFER,g),l.viewport(0,0,g.width,g.height)):l.viewport(0,0,this._cvs.width,this._cvs.height),h=a._children,l.clearColor(o._r,o._g,o._b,o._a),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),l.enable(l.DEPTH_TEST),l.depthFunc(l.LESS);for(r in a._glPROGRAMs)_=a._glPROGRAMs[r],l.useProgram(_),l.uniformMatrix4fv(_.uPixelMatrix,!1,o._pixelMatrix),l.uniformMatrix4fv(_.uCameraMatrix,!1,o.getMatrix());u=c=_=m=d=null;for(r in h){u=h[r],m=a._glVBOs[u._geometry._key],v=a._glVNBOs[u._geometry._key],f=a._glUVBOs[u._geometry._key],d=a._glIBOs[u._geometry._key],c=u._material,p=c._diffuse;var T=[0,1,1],P=0;if(0==p.__indexList.length)"none"==c._shading.type?(_=a._glPROGRAMs.color,l.useProgram(_)):"toon"==c._shading.type?(_=a._glPROGRAMs.colorToon,l.useProgram(_),P=1):"gouraud"==c._shading.type?(_=a._glPROGRAMs.colorGouraud,l.useProgram(_),P=1):"phong"==c._shading.type&&(_=a._glPROGRAMs.colorPhong,l.useProgram(_),P=1),M!=_&&(M=null,x=null,A=null,R=null,b=null,y=null),P&&(v!=A?l.bindBuffer(l.ARRAY_BUFFER,v):0,v!=A?l.vertexAttribPointer(_.aVertexNormal,v.stride,l.FLOAT,!1,0,0):0,l.uniform3fv(_.uDLite,T),l.uniform1f(_.uLambert,c._shading.lambert)),m!=x?l.bindBuffer(l.ARRAY_BUFFER,m):0,m!=x?l.vertexAttribPointer(_.aVertexPosition,m.stride,l.FLOAT,!1,0,0):0,n[0]=c._r,n[1]=c._g,n[2]=c._b,l.uniform3fv(_.uColor,n);else{"none"==c._shading.type?(_=a._glPROGRAMs.bitmap,l.useProgram(_)):"flat"==c._shading.type||("gouraud"==c._shading.type?(_=a._glPROGRAMs.bitmapGouraud,l.useProgram(_),P=1):"phong"==c._shading.type?(_=a._glPROGRAMs.bitmapPhong,l.useProgram(_),P=1):"blinn"==c._shading.type),M!=_&&(M=null,x=null,A=null,R=null,b=null,y=null),P&&(v!=A?l.bindBuffer(l.ARRAY_BUFFER,v):0,v!=A?l.vertexAttribPointer(_.aVertexNormal,v.stride,l.FLOAT,!1,0,0):0,l.uniform3fv(_.uDLite,T),l.uniform1f(_.uLambert,c._shading.lambert)),m!=x?l.bindBuffer(l.ARRAY_BUFFER,m):0,m!=x?l.vertexAttribPointer(_.aVertexPosition,m.stride,l.FLOAT,!1,0,0):0,f!=R?l.bindBuffer(l.ARRAY_BUFFER,f):0,f!=R?l.vertexAttribPointer(_.aUV,f.stride,l.FLOAT,!1,0,0):0,l.activeTexture(l.TEXTURE0);var F=a._glTEXTUREs[p.__indexList[0].id];F.loaded&&(F!=y?l.bindTexture(l.TEXTURE_2D,F):0,l.uniform1i(_.uSampler,0))}n[0]=u.rotateX,n[1]=u.rotateY,n[2]=u.rotateZ,l.uniform3fv(_.uRotate,n),n[0]=-u.x,n[1]=-u.y,n[2]=u.z,l.uniform3fv(_.uPosition,n),n[0]=u.scaleX,n[1]=u.scaleY,n[2]=u.scaleZ,l.uniform3fv(_.uScale,n),d!=b?l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,d):0,c._wireFrame?(_=a._glPROGRAMs.color,l.useProgram(_),m!=x?l.bindBuffer(l.ARRAY_BUFFER,m):0,m!=x?l.vertexAttribPointer(_.aVertexPosition,m.stride,l.FLOAT,!1,0,0):0,n[0]=u.rotateX,n[1]=u.rotateY,n[2]=u.rotateZ,l.uniform3fv(_.uRotate,n),n[0]=-u.x,n[1]=-u.y,n[2]=u.z,l.uniform3fv(_.uPosition,n),n[0]=u.scaleX,n[1]=u.scaleY,n[2]=u.scaleZ,l.uniform3fv(_.uScale,n),n[0]=c._rw,n[1]=c._gw,n[2]=c._bw,l.uniform3fv(_.uColor,n),l.drawElements(l.LINES,d.numItem,l.UNSIGNED_SHORT,0)):l.drawElements(l.TRIANGLES,d.numItem,l.UNSIGNED_SHORT,0),M=_,x=m,A=P?v:null,R=f,b=d,y=F}l.bindFramebuffer(l.FRAMEBUFFER,null)}if(s>1){if(l.viewport(0,0,this._cvs.clientWidth,this._cvs.clientHeight),l.clearColor(0,0,0,1),l.disable(l.DEPTH_TEST),l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),m=a._glVBOs.rect,f=a._glUVBOs.rect,d=a._glIBOs.rect,_=a._glPROGRAMs.bitmap,!m)return;for(l.useProgram(_),l.uniformMatrix4fv(_.uPixelMatrix,!1,[2/this._cvs.clientWidth,0,0,0,0,-2/this._cvs.clientHeight,0,0,0,0,0,0,-1,1,0,1]),l.bindBuffer(l.ARRAY_BUFFER,m),l.vertexAttribPointer(_.aVertexPosition,m.stride,l.FLOAT,!1,0,0),l.bindBuffer(l.ARRAY_BUFFER,f),l.vertexAttribPointer(_.aUV,f.stride,l.FLOAT,!1,0,0),l.uniform3fv(_.uRotate,[0,0,0]),l.uniformMatrix4fv(_.uCameraMatrix,!1,i),e=0,s=E.length;s>e;e++)a=E[e].scene,o=a.getChild(E[e].cameraID),o._visible&&(g=a._glFREAMBUFFERs[o.uuid].frameBuffer,n[0]=g.x+g.width/2,n[1]=g.y+g.height/2,n[2]=0,l.uniform3fv(_.uPosition,n),n[0]=g.width/2,n[1]=g.height/2,n[2]=1,l.uniform3fv(_.uScale,n),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,a._glFREAMBUFFERs[o.uuid].texture),l.uniform1i(_.uSampler,0),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,d),l.drawElements(l.TRIANGLES,d.numItem,l.UNSIGNED_SHORT,0))}},r.addRender=function(e,r,i){t.isAlive(this);var n,s,a,o,l,h;for(n=e+"_"+r,s=this._sceneList[e],a=this._renderList,o=0,l=a.length;l>o;o++)a[o].uuid==n&&t.error("World","addRender",0);return s?s.isAlive||t.error("World","addRender",1):t.error("World","addRender",1),s&&(s.getChild(r)?s.getChild(r).isAlive||t.error("World","addRender",2):t.error("World","addRender",2)),h={uuid:n,sceneID:e,cameraID:r,scene:s,camera:s.getChild(r)},s._update=1,i?a[i]=h:a.push(h),this},r.addScene=function(e,r){return t.isAlive(this),this._sceneList[e]&&t.error("World","addScene",0),r instanceof p||t.error("World","addScene",1),this._sceneList[e]=r,r._gl=this._gl,r._cvs=this._cvs,this},r.getScene=function(e){return t.isAlive(this),"undefined"==typeof e&&t.error("World","getScene",0),this._sceneList[e]?this._sceneList[e]:null},r.removeRender=function(e,r){t.isAlive(this);var i,n,s=this._renderList,a=0,o=0;for(this._sceneList[e]||t.error("World","removeRender",0),this._sceneList[e]._cameras[r]||(console.log("2222222222222222222222222"),t.error("World","removeRender",1)),i=0,n=s.length;n>i;i++)s[i].uuid.indexOf(e)>-1&&(a=1),s[i].uuid.indexOf(r)>-1&&(o=1);for(a||t.error("World","removeRender",2),o||t.error("World","removeRender",3),i=0,n=s.length;n>i;i++)s[i]&&s[i].uuid==e+"_"+r&&s.splice(i,1);return this},r.removeScene=function(e){return t.isAlive(this),this._sceneList[e]?0:t.error("World","removeScene",0),this._sceneList[e]._gl=this._gl,delete this._sceneList[e],this},t.ext(e,t)}();for(m in _={BlendMode:r,Filter:i,Vertex:n,Shading:s,VertexShader:a,Matrix:l,Geometry:h,Material:u,Texture:c,Primitive:v,Mesh:f,Group:d,Camera:g,Scene:p,World:x,globalization:function(){for(var t in this)e[t]=this[t]}})t[m]=_[m];Object.freeze(t),e.MoGL=t}(this),"undefined"!=typeof module&&"object"==typeof module&&(module.exports=MoGL);